(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[94],{6094:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return Mt}});var n={};o.r(n),o.d(n,{allowLine:function(){return N},appendChild:function(){return b},appendChildren:function(){return w},createDom:function(){return O},createTextNode:function(){return T},emptyAllChild:function(){return x},getBlock:function(){return L},getContainer:function(){return j},getContainerChildNode:function(){return B},getEndLeafNode:function(){return H},getNextBlock:function(){return M},getNextLeafNodeInContainer:function(){return U},getNextNodeInContainer:function(){return X},getNextNodeInTopNode:function(){return $},getNodeIndexOf:function(){return k},getNodeStyle:function(){return D},getPreBlock:function(){return I},getPreLeafNodeInContainer:function(){return V},getPreNodeInContainer:function(){return F},getSingleNodeInContainer:function(){return P},getStartLeafNode:function(){return z},insertAfter:function(){return v},insertBefore:function(){return y},isBlock:function(){return p},isContainer:function(){return f},isElementEqual:function(){return C},isEmpty:function(){return m},isNotBlock:function(){return h},isNotContainer:function(){return u},isStartInContainer:function(){return E},mergeTwoNodes:function(){return R},nodeLabel:function(){return g},removeChild:function(){return _},removeNode:function(){return S},splitFromNodeOffsetStillTop:function(){return A}});var i={};o.r(i),o.d(i,{getRange:function(){return W},getRangeOfNodeEnd:function(){return oe},getRangeOfNodeStart:function(){return ee},isEndInContainer:function(){return J},isStartInContainer:function(){return Z},setCollapsedRange:function(){return G},setNewCollapsedRange:function(){return Y},setNewRange:function(){return K},setRange:function(){return q},setRangeOfNodeEnd:function(){return te},setRangeOfNodeStart:function(){return Q}});var r={};o.r(r),o.d(r,{code:function(){return Oe},header:function(){return ue},image:function(){return Te},list:function(){return Be},mathjax:function(){return $e},paragraph:function(){return fe},text:function(){return Xe}});var l=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"paper"}},[t("div",{staticClass:"header"},[t("div",{staticClass:"title"},[t("div",{staticClass:"iconfont icon-paper"}),t("div",{staticClass:"text"},[e._v("论文解析")]),t("div",{staticClass:"text",attrs:{"v-if":e.selectedPaper}},[e._v(e._s(e.selectedPaper))])])]),t("div",{staticClass:"main"},[t("div",{staticClass:"bar"},[t("div",{staticClass:"item-btn",attrs:{"data-selected":e.paperListVisible,title:"论文列表"},on:{mousedown:function(t){return e.setPaperListVisible()}}},[e._v("列")]),t("div",{staticClass:"item-btn editor_layout",attrs:{"data-show":!!e.paperList[e.selectedPaperIndex],title:"视图布局"}},[e._v(" 视 "),t("div",{staticClass:"layout"},e._l(e.layoutTypes,(function(o,n){return t("div",{staticClass:"layout_button",attrs:{title:o.title,"data-selected":e.layoutType===n},on:{mousedown:function(t){return e.setLayoutType(n)}}},[e._v(e._s(o.type))])})),0)]),t("div",{staticClass:"item-btn editable",attrs:{"data-selected":e.editable,"data-show":!!e.paperList[e.selectedPaperIndex]&&e.paperList[e.selectedPaperIndex].allowChange,title:"编辑"},on:{mousedown:function(t){return e.setEditable()}}},[e._v("编")])]),t("div",{staticClass:"items"},[e.selectedPaper?e._e():t("div",{staticClass:"noSelectedPaper"},[e._v("还未选择论文")]),t("div",{staticClass:"item list",attrs:{"data-show":e.paperListVisible},on:{mousedown:function(t){return e.setPaperListVisible(!1)}}},e._l(e.paperList,(function(o,n){return t("div",{staticClass:"paper-name",attrs:{"data-selected":e.selectedPaperIndex===n},on:{mousedown:function(t){return t.stopPropagation(),e.setPaper(n)}}},[t("div",{staticClass:"name"},[e._v(e._s(o.name))])])})),0),t("div",{ref:"pdf",staticClass:"item pdf"},[t("v-viewPdf",{attrs:{paper:e.selectedPaper}})],1),t("div",{ref:"editor",staticClass:"item editor"},[t("v-viewEditor",{attrs:{layoutType:e.layoutType,editable:e.editable,paper:e.selectedPaper}})],1)])])])},a=[],s=(o(7658),JSON.parse('[{"name":"A Technique for Drawing Directed Graphs","allowChange":true},{"name":"A Browser for Directed Graphs","allowChange":true},{"name":"Methods for Visual Understanding of Hierarchical System Structures","allowChange":true},{"name":"Simple and Efficient Bilayer Cross Counting","allowChange":true},{"name":"Fast and Simple Horizontal Coordinate Assignment","allowChange":true}]')),d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"paper_view-editor"},[t("div",{staticClass:"editor_tooltip",attrs:{"data-show":e.editable}},[t("v-tooltip",{attrs:{editor:e.editing,anotherEditor:e.anotherEditor,allEditors:e.allEditors}})],1),t("div",{staticClass:"editors"},[t("div",{ref:"originalEditorContainer",staticClass:"editor_container",attrs:{"data-selected":e.editing&&e.editing===e.originalEditor},on:{mousedown:function(t){return e.setEditing(e.originalEditor,e.translationEditor)}}},[t("div",{ref:"originalEditor",staticClass:"editorDom"})]),t("div",{ref:"translationEditorContainer",staticClass:"editor_container",attrs:{"data-selected":e.editing&&e.editing===e.translationEditor},on:{mousedown:function(t){return e.setEditing(e.translationEditor,e.originalEditor)}}},[t("div",{ref:"translationEditor",staticClass:"editorDom"})])])])},c=[];const g={block:"block",container:"container",allowLine:"allow-line"};function p(e){return e.nodeType===Node.ELEMENT_NODE&&!!e.getAttribute("block")}function h(e){return e.nodeType!==Node.ELEMENT_NODE||!e.getAttribute("block")}function f(e){return e.nodeType===Node.ELEMENT_NODE&&!!e.getAttribute("container")}function u(e){return e.nodeType!==Node.ELEMENT_NODE||!e.getAttribute("container")}function m(e){return 0===e.childNodes.length}function N(e){return e.nodeType===Node.ELEMENT_NODE&&!!e.getAttribute("allow-line")}function C(e,t){if(e===t)return!0;Object.getOwnPropertyNames(e),Object.getOwnPropertyNames(t);if(e.nodeType!==t.nodeType)return console.log("node 类型不同","a:",e,"b:",t),!1;if(e.nodeType===Node.ELEMENT_NODE){if(e.nodeName!==t.nodeName)return console.log("标签 nodeName 不一样"),console.log("a:",e),console.log("b:",t),!1;if(e.attributes.length!==t.attributes.length)return console.log("attributes 长度不一样"),console.log("a:",e,"attribute",e.attributes),console.log("b:",t,"attribute",t.attributes),!1;for(let o=0;o<e.attributes.length;o++){let n=e.attributes.item(o),i=t.attributes.item(o);if(n.name!==i.name||n.value!==i.value)return console.log("attributes 属性不一样"),console.log("a:",e,"attribute",e.attributes.item(o)),console.log("b:",t,"attribute",t.attributes.item(o)),!1}if(e.style.length!==t.style.length)return console.log("style 长度不一样"),console.log("a:",e,"style",e.style),console.log("b:",t,"style",t.style),!1;for(let o=0;o<e.style.length;o++){let n=e.style[o],i=t.style[o];if(n!==i)return console.log("style 属性不一样"),console.log("a:",e,"style",e.style[o]),console.log("b:",t,"style",t.style[o]),!1;if(e.style[n]!==t.style[i])return console.log("style 属性不一样"),console.log("a:",e,`a.style[${n}]`,e.style[n]),console.log("b:",t,`b.style[${i}]`,t.style[i]),!1}}return!0}function E(e){let t=e.parentNode;while(u(e)){if(t.childNodes[0]!==e)return!1;e=t,t=e.parentNode}return!0}function y(e,t){t.parentNode.insertBefore(e,t)}function v(e,t){let o=t.parentNode;t.nextSibling?o.insertBefore(e,t.nextSibling):o.appendChild(e)}function b(e,t){e.appendChild(t)}function w(e,t){if(NodeList.prototype.isPrototypeOf(t))for(let o=0,n=t.length;o<n;o++)e.appendChild(t[0]);else{if(!Array.prototype.isPrototypeOf(t))throw console.error("childrenNodes:",t),new Error("appendChildren 传参错误, childrenNodes 类型未知");for(let o=0,n=t.length;o<n;o++)e.appendChild(t[o])}}function T(e){return document.createTextNode(e)}function O(e){if(void 0===e.if||e.if){if("string"===typeof e)return document.createTextNode(text);if("object"===typeof e){let{nodeName:t,attributes:o,on:n,style:i,children:r,created:l}=e,a=document.createElement(t);if(o){if("object"!==typeof o)throw console.error(o),new Error("创建组件 dom 时遇到情况外的 attributes 类型");Object.keys(o).forEach((e=>{void 0!==o[e]&&null!==o[e]&&a.setAttribute(e,o[e])}))}if(i){if("object"!==typeof i)throw console.error(i),new Error("创建组件 dom 时遇到情况外的 style 类型");Object.keys(i).forEach((e=>{void 0!==i[e]&&null!==i[e]&&""!==i[e]&&(a.style[e]=i[e])}))}if(r)if(Array.isArray(r))r.forEach((e=>{let t=O(e);t&&a.appendChild(t)}));else if("object"===typeof r){let e=O(r);e&&a.appendChild(e)}else{if("string"!==typeof r)throw console.error(r),new Error("创建组件 dom 时遇到情况外的 children 类型");a.appendChild(document.createTextNode(r))}if(l){if("function"!==typeof l)throw console.error(l),new Error("创建组件 dom 时遇到情况外的 created 类型");l(a)}return a}throw console.error(e),new Error("创建组件 dom 时遇到情况外的 obj 类型")}}function x(e){for(let t=e.childNodes.length-1;t>=0;t--)e.removeChild(e.childNodes[t])}function _(e,t){e.removeChild(newNode)}function S(e){e.parentNode.removeChild(e)}function R(e,t){if(console.log("%c合并两个节点 node mergeTwoNodes","color: #000000; background-color: #ffffff"),console.log("pre:",e,"\nnext:",t),e.nodeType===Node.TEXT_NODE&&t.nodeType===Node.TEXT_NODE)console.log("节点都是 text"),e.parentNode.normalize();else if(C(e,t))if(console.log("节点元素信息一致，可以合并"),e.childNodes.length>0&&t.childNodes.length>0){let o=e.childNodes[e.childNodes.length-1],n=t.childNodes[0];w(e,t.childNodes),S(t),R(o,n)}else 0===e.childNodes.length&&t.childNodes.length>0&&(w(e,t.childNodes),S(t))}function A(e,t,o){if(!o.contains(e))throw console.error("node:",e,"topNode:",o),new Error("splitFromNodeOffsetInContainer 传参错误, node 不包含在 topNode 中");let n,i,r,l;if(e.nodeType===Node.TEXT_NODE?t===e.length?n=$(e,o):0===t?n=e:(e.splitText(t),n=e.nextSibling):e.nodeType===Node.ELEMENT_NODE&&(n=0===t?e:t===e.childNodes.length?$(e.childNodes[t-1],o):e.childNodes[t]),!n)return o.cloneNode();while(n.parentNode&&n!==o){let e,t=n.nextSibling;i=n.parentNode,r=i.cloneNode(!1),l?r.appendChild(l):r.appendChild(n),l=r;while(t)e=t.nextSibling,r.appendChild(t),t=e;n=i}return r}function k(e){let t=e.parentNode.childNodes;for(let o=0,n=t.length;o<n;o++)if(e===t[o])return o}function D(e){let t;if(e.style.length>0){t={};for(let o=0;o<e.style.length;o++){let n=e.style[o];t[n]=e.style[n]}}return t}function L(e){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e),new Error("getBlock 传参错误");let t=e,o=e.parentNode;while(h(t))t=o,o=t.parentNode;return t}function I(e){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e),new Error("getPreBlock 传参错误");if(p(e))return e.previousSibling;{let t=e,o=e.parentNode;while(h(t))t=o,o=t.parentNode;return t.previousSibling}}function M(e){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e),new Error("getNextBlock 传参错误");if(p(e))return e.nextSibling;{let t=e,o=e.parentNode;while(h(t))t=o,o=t.parentNode;return t.nextSibling}}function j(e){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e,"\nnode.nodeType:",e.nodeType,"\nnode.parentNode:",e.parentNode),new Error("getContainer 传参错误");let t=e,o=e.parentNode;while(u(t))t=o,o=t.parentNode;return t}function B(e){if(!e||!e.nodeType||!e.parentNode||f(e))throw console.error("node:",e),new Error("getContainerChildNode 传参错误");let t=e,o=e.parentNode;while(u(o))t=o,o=t.parentNode;return t}function P(e){if(!e||!e.nodeType||!e.parentNode||f(e))throw console.error("node:",e),new Error("getSingleNodeInContainer 传参错误");let t=e,o=e.parentNode;while(1===o.childNodes.length&&u(o))t=o,o=t.parentNode;return t}function F(e){if(!e||!e.nodeType||!e.parentNode||f(e))throw console.error("node:",e),new Error("getPreNodeInContainer 传参错误");while(!e.previousSibling)if(e=e.parentNode,f(e))return null;return e.previousSibling}function V(e){let t=F(e);if(t){while(t.childNodes.length>0)t=t.childNodes[t.childNodes.length-1];return t}return null}function H(e){while(e.childNodes.length>0)e=e.childNodes[e.childNodes.length-1];return e}function X(e){if(!e||!e.nodeType||!e.parentNode||f(e))throw console.error("node:",e),new Error("getNextNodeInContainer 传参错误");while(!e.nextSibling)if(e=e.parentNode,f(e))return null;return e.nextSibling}function $(e,t){if(!e||!e.nodeType||!e.parentNode||!t.contains(e))throw console.error("node:",e),new Error("getNextNodeInTopNode 传参错误");while(!e.nextSibling)if(e=e.parentNode,e===t)return null;return e.nextSibling}function U(e){let t=X(e);if(t){while(t.childNodes.length>0)t=t.childNodes[0];return t}return null}function z(e){while(e.childNodes.length>0)e=e.childNodes[0];return e}function Z(e,t){if(0===t){let t=e.parentNode;while(u(e)){if(t.childNodes[0]!==e)return!1;e=t,t=e.parentNode}return E(e)}return!1}function J(e,t){if(e.nodeType===Node.TEXT_NODE){if(t!==e.length)return!1}else if(e.nodeType===Node.ELEMENT_NODE&&t!==e.childNodes.length)return!1;let o=e.parentNode;while(u(e)){let t=o.childNodes.length;if(o.childNodes[t-1]!==e)return!1;e=o,o=e.parentNode}return!0}function W(){let e=document.getSelection();return"None"!==e.type?e.getRangeAt(0):null}function q(e,t,o,n){let i=document.getSelection().getRangeAt(0);i.startContainer===e&&i.startOffset===t?console.log("start range 一样不需要设置"):i.setStart(e,t),i.endContainer===o&&i.endOffset===n?console.log("end range 一样不需要设置"):i.setEnd(o,n)}function G(e,t){let o=document.getSelection().getRangeAt(0);o.startContainer===e&&o.startOffset===t?console.log("start range 一样不需要设置"):o.setStart(e,t),o.endContainer===e&&o.endOffset===t?console.log("end range 一样不需要设置"):o.setEnd(e,t)}function K(e,t,o,n){let i=document.getSelection(),r=document.createRange();r.setStart(e,t),r.setEnd(o,n),i.removeAllRanges(r),i.addRange(r)}function Y(e,t){let o=document.getSelection(),n=document.createRange();n.setStart(e,t),n.setEnd(e,t),o.removeAllRanges(n),o.addRange(n)}function Q(e,t){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e),new Error("setRangeOfNodeStart 传参错误");while(e.childNodes.length>0)e=e.childNodes[0];let o,n;if(e||console.error("node不存在, 请检查组件设计是否正确"),e.nodeType===Node.TEXT_NODE)o=e,n=0;else{if(e.nodeType!==Node.ELEMENT_NODE)throw console.error("节点:",e),new Error("没有处理的节点类型");o=e.parentNode,n=k(e)}return t?Y(o,n):G(o,n),[o,n]}function ee(e){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e),new Error("getRangeOfNodeStart 传参错误");while(e.childNodes.length>0)e=e.childNodes[0];let t,o;if(e||console.error("node不存在, 请检查组件设计是否正确"),e.nodeType===Node.TEXT_NODE)t=e,o=0;else{if(e.nodeType!==Node.ELEMENT_NODE)throw console.error("节点:",e),new Error("没有处理的节点类型");t=e.parentNode,o=k(e)}return[t,o]}function te(e,t){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e),new Error("setRangeOfNodeEnd 传参错误");while(e.childNodes.length>0)e=e.childNodes[e.childNodes.length-1];let o,n;if(e.nodeType===Node.TEXT_NODE)o=e,n=e.length;else{if(e.nodeType!==Node.ELEMENT_NODE)throw console.error("节点:",e),new Error("没有处理的节点类型");o=e.parentNode,n=k(e)+1}return t?Y(o,n):G(o,n),[o,n]}function oe(e){if(!e||!e.nodeType||!e.parentNode)throw console.error("node:",e),new Error("getRangeOfNodeEnd 传参错误");while(e.childNodes.length>0)e=e.childNodes[e.childNodes.length-1];let t,o;if(e.nodeType===Node.TEXT_NODE)t=e,o=e.length;else{if(e.nodeType!==Node.ELEMENT_NODE)throw console.error("节点:",e),new Error("没有处理的节点类型");t=e.parentNode,o=k(e)+1}return[t,o]}function ne(e,t){console.log("%c执行 deleteForward","color: #000000; background-color: #ffffff"),console.log("node:",e,"\noffset:",t);let{rangeApi:o,nodeApi:n}=this,i=n.getBlock(e);if(e.nodeType===Node.TEXT_NODE){console.log("为 TEXT_NODE");let r=n.getSingleNodeInContainer(e),l=n.getPreNodeInContainer(r);n.getNextNodeInContainer(r);if(0===t)if(console.log("偏移量为0的特殊位置"),l){console.log("preNode 存在, 当前节点应该为 block 样式, 再次执行 deleteForward");let[e,t]=o.getRangeOfNodeEnd(l);ne.call(this,e,t)}else console.log("preNode 存在, 是 container 内的第一个节点"),this.executeEditorEvent(i,this.eventType.deleteForwardOnStart,[e,t]);else 1===t?(console.log("偏移量为1的特殊位置"),1===e.length?(console.log("删空 text"),ie.call(this,e)):(console.log("删除一个字符"),l?(console.log("跳到前一个节点末端"),o.setRangeOfNodeEnd(l)):(console.log("是 conatiner 内部的第一个叶子节点, 坐标定位到 text 头部"),o.setCollapsedRange(e,0)),e.deleteData(0,1))):(console.log("正常删除一个字符"),o.setCollapsedRange(e,t-1),e.deleteData(t-1,1))}else{if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("deleteForward node 类型未知");{let r;console.log("为 ELEMENT_NODE"),0===t?e.childNodes[0]&&(r=n.getPreLeafNodeInContainer(e.childNodes[0])):r=e.childNodes[t-1],r?(console.log("element 存在"),r.nodeType===Node.TEXT_NODE?(console.log("element 是 text"),o.setCollapsedRange(r,r.length-1),r.deleteData(r.length-1,1)):r.nodeType===Node.ELEMENT_NODE&&(console.log("element 是 元素"),ie.call(this,r))):(console.log("element 不存在, 是 container 内的第一个节点"),this.executeEditorEvent(i,this.eventType.deleteForwardOnStart,[e,t]))}}}function ie(e){console.log("%cdeleteLeafNodeInContainer 删除元素","color: #000000; background-color: #ffffff"),console.log("node:",e);let{rangeApi:t,nodeApi:o}=this,n=o.getSingleNodeInContainer(e),i=n.parentNode,r=o.getPreNodeInContainer(n),l=o.getNextNodeInContainer(n);if(r){console.log("前面有节点");let e=n.previousSibling,i=n.nextSibling;t.setRangeOfNodeEnd(r),o.removeNode(n),e&&i&&o.mergeTwoNodes(e,i)}else if(console.log("前面没有节点"),l)console.log("后面有节点"),t.setRangeOfNodeStart(l),o.removeNode(n);else{if(console.log("后面没有节点"),!o.isContainer(i))throw new Error("特殊情况,按照常理,前后都没有的话, parentNode 应该是 container,不会打印此信息");t.setCollapsedRange(i,0),o.removeNode(n)}}function re(e,t){console.log("%c执行 deleteForwardOnStart","color: #000000; background-color: #ffffff"),console.log("node:",e,"\noffset:",t);let{rangeApi:o,nodeApi:n}=this,i=(n.getContainer(e),n.getBlock(e)),r=n.getPreBlock(i);if(r)if(console.log("存在前一个 Block"),n.isEmpty(r))console.log("前一个 Block 为空, 删除前一个 Block, range 不变"),n.removeNode(r);else{console.log("前一个 Block 不为空");let e=this.executeHelpEvent(r,this.helpEventType.getLastContainer,[r]);o.setRangeOfNodeEnd(e),n.isEmpty(i)?(console.log("当前 Block 为空, 删除当前 Block"),n.removeNode(i)):(console.log("当前 Block 不为空, 执行 mergeTwoBlocks, 根据不同情况合并两个 Block"),this.mergeTwoBlocks(r,i))}else console.log("不存在前一个 Block , 为第一个 Block , 不做任何操作")}function le(e,t,o,n){console.log("%c执行 deleteFragment","color: #000000; background-color: #ffffff"),console.log("startContainer:",e,"\nstartOffset:",t,"\nendContainer:",o,"\nendOffset:",n);let{rangeApi:i,nodeApi:r}=this;if(e&&o){console.log("fragment 在 container 中");let l=r.getContainer(e);i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端"),i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端, 清空 container"),i.setCollapsedRange(l,0),r.emptyAllChild(l)):(console.log("endContainer 光标不在 container 最未端"),ae.call(this,l,o,n))):(console.log("startContainer 光标不在 container 最前端"),i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端"),de.call(this,l,e,t)):(console.log("endContainer 光标不在 container 最未端"),se.call(this,l,e,t,o,n)))}else if(e){console.log("container 后半部分在 fragment 中, 需要选择 range");let o=r.getContainer(e);i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端, 清空 container"),r.emptyAllChild(o),i.setCollapsedRange(o,0)):i.isEndInContainer(e,t)?(console.log("startContainer 光标在 container 最未端, 光标重叠选择 container 最未端"),i.setCollapsedRange(e,t)):(console.log("startContainer 光标在 container 中间"),de.call(this,o,e,t))}else{if(!o)throw console.error("startContainer:",e,"startOffset:",t,"endContainer:",o,"endOffset:",n),new Error("不知道的特殊情况");{console.log("container 前半部分在 fragment 中, 不需要选择 range");let e=r.getContainer(o);i.isStartInContainer(o,n)?console.log("endContainer 光标在 container 最前端, 无操作"):i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端, 清空 container"),r.emptyAllChild(e)):(console.log("endContainer 光标在 container 中间"),ae.call(this,e,o,n,!1))}}}function ae(e,t,o,n=!0){console.log("%c删除 container 开始部分片段","color: #000000; background-color: #ffffff");let{rangeApi:i,nodeApi:r}=this,l=r.splitFromNodeOffsetStillTop(t,o,e);if(!r.isContainer(l))throw console.error("endFragment:",l),new Error("按道理 endFragment 应该是 container");r.emptyAllChild(e),r.appendChildren(e,l.childNodes),l=null,n?(console.log("进行光标选择"),i.setRangeOfNodeStart(e)):console.log("不进行光标选择")}function se(e,t,o,n,i){console.log("%c删除 container 中间部分片段","color: #000000; background-color: #ffffff");let{rangeApi:r,nodeApi:l}=this,a=l.splitFromNodeOffsetStillTop(n,i,e);de.call(this,e,t,o),l.insertAfter(a,e),l.mergeTwoNodes(e,a)}function de(e,t,o,n=!0){console.log("%c删除 container 结尾部分片段","color: #000000; background-color: #ffffff");let{rangeApi:i,nodeApi:r}=this;r.splitFromNodeOffsetStillTop(t,o,e),n&&i.setRangeOfNodeEnd(e)}function ce(e,t){console.log("%c执行 enter","color: #000000; background-color: #ffffff"),console.log("node:",e,"\noffset:",t);let{rangeApi:o,nodeApi:n}=this,i=n.getContainer(e),r=n.splitFromNodeOffsetStillTop(e,t,i);if(console.log("splitedNode:",r),r)n.insertAfter(r,i),r.childNodes.length?o.setRangeOfNodeStart(r):o.setCollapsedRange(r,0);else{let e=i.cloneNode(!1);n.insertAfter(e,i),o.setCollapsedRange(e,0)}}function ge(e,t,o,n){console.log("%c执行 enterFragment","color: #000000; background-color: #ffffff"),console.log("startContainer:",e,"\nstartOffset:",t,"\nendContainer:",o,"\nendOffset:",n);let{rangeApi:i,nodeApi:r}=this;if(e&&o){console.log("fragment 在 container 中");let l=r.getContainer(e),a=l.cloneNode(!1);i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端"),i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端, 清空 container"),r.insertAfter(a,l),i.setCollapsedRange(a,0),r.emptyAllChild(l)):(console.log("endContainer 光标不在 container 最未端"),r.insertBefore(a,l),ae.call(this,l,o,n))):(console.log("startContainer 光标不在 container 最前端"),i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端"),r.insertAfter(a,l),i.setCollapsedRange(a,0),de.call(this,l,e,t,!1)):(console.log("endContainer 光标不在 container 最未端"),pe.call(this,l,e,t,o,n)))}else if(e){console.log("container 后半部分在 fragment 中, 不需要选择 range");let o=r.getContainer(e);i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端, 清空 container"),r.emptyAllChild(o)):i.isEndInContainer(e,t)?console.log("startContainer 光标在 container 最未端, 无操作"):(console.log("startContainer 光标在 container 中间"),de.call(this,o,e,t,!1))}else{if(!o)throw console.error("startContainer:",e,"startOffset:",t,"endContainer:",o,"endOffset:",n),new Error("不知道的特殊情况");{console.log("container 前半部分在 fragment 中, 需要选择 range");let e=r.getContainer(o);i.isStartInContainer(o,n)?(console.log("endContainer 光标在 container 最前端, 光标重叠选择 container 最前端"),o.childNodes.length>0?i.setRangeOfNodeStart(o):i.setCollapsedRange(o,0)):i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端, 清空 container"),r.emptyAllChild(e),i.setCollapsedRange(e,0)):(console.log("endContainer 光标在 container 中间"),ae.call(this,e,o,n))}}}function pe(e,t,o,n,i){console.log("%c删除 container 中间部分片段","color: #000000; background-color: #ffffff");let{rangeApi:r,nodeApi:l}=this,a=l.splitFromNodeOffsetStillTop(n,i,e);de.call(this,e,t,o,!1),l.insertAfter(a,e),r.setRangeOfNodeStart(a)}var he={deleteForward:ne,deleteForwardOnStart:re,deleteFragment:le,enter:ce,enterFragment:ge},fe={type:"paragraph",event:he,toDom(e){return this.nodeApi.createDom({nodeName:"div",attributes:{class:"paragraph",[this.nodeLabel.block]:!0,[this.nodeLabel.container]:!0},created:t=>{Array.isArray(e.data)&&e.data.forEach(((e,o,n)=>{if(n[o+1]&&n[o+1].type===e.type&&"text"===e.type)throw console.error(e,n[o+1]),new Error("存在两个连续的 text");let i=this.objToDom(e);if(!i)throw console.error(e),new Error("组件读取解析失败");this.nodeApi.appendChild(t,i)}))}})},toObj(e){let t={type:"paragraph",data:[]};return e.childNodes.forEach(((e,o,n)=>{t.data.push(this.domToObj(e))})),t},helpEvent:{getFirstContainer(e){return e},getLastContainer(e){return e},getMergeContainer(e){return e},getMergedNodes(e){return e.childNodes},mergedDeleteNode(e){return e}}},ue={type:"header",event:he,toDom(e){return this.nodeApi.createDom({nodeName:e.level,attributes:{class:"header",[this.nodeLabel.block]:!0,[this.nodeLabel.container]:!0},created:t=>{Array.isArray(e.data)?e.data.forEach(((e,o,n)=>{if(n[o+1]&&n[o+1].type===e.type&&"text"===e.type)throw console.error(e,n[o+1]),new Error("存在两个连续的 text");let i=this.objToDom(e);if(!i)throw console.error(e),new Error("组件读取解析失败");this.nodeApi.appendChild(t,i)})):"string"===typeof e.data&&this.nodeApi.appendChild(t,this.nodeApi.createTextNode(e.data))}})},toObj(e){let t={type:"header",level:e.nodeName.toLowerCase()};return e.childNodes.length>1?(t.data=[],e.childNodes.forEach((e=>{t.data.push(this.domToObj(e))}))):1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE?t.data=e.childNodes[0].nodeValue:t.data="",t},helpEvent:{getFirstContainer(e){return e},getLastContainer(e){return e},getMergeContainer(e){return e},getMergedNodes(e){return e.childNodes},mergedDeleteNode(e){return e}}};function me(e,t){console.log("%c执行 deleteForward","color: #000000; background-color: #ffffff"),console.log("node:",e,"\noffset:",t);let{rangeApi:o,nodeApi:n}=this,i=n.getBlock(e),r=n.getPreBlock(i),l=n.getContainer(e);if(Ne(l)){console.log("在 img_container 中");let e=this.executeHelpEvent(r,this.helpEventType.getLastContainer,[r]);if(o.setRangeOfNodeEnd(e),0===t);else{if(1!==t)throw new Error("offset 应该是 0 或者 1");n.removeNode(i)}}else{if(!Ce(l))throw new Error("image 内不应该有别的类型 container");if(console.log("在 image_title 中"),e.nodeType===Node.TEXT_NODE){if(!n.isStartInContainer(e))throw new Error("node 应该为 container 的第一个节点");0===t?(console.log("偏移量为 0"),o.setRangeOfNodeEnd(l.previousSibling)):1===t&&1===e.length?(console.log("删空 text"),o.setCollapsedRange(l,0),n.removeNode(e)):(console.log("光标进一"),o.setCollapsedRange(e,t-1),e.deleteData(t-1,1))}else if(e.nodeType===Node.ELEMENT_NODE){if(0!==t)throw new Error("image_title 只有偏移量为 0 ,节点内容为空时, node 类型才会是 ELEMENT_NODE");console.log("偏移量为 0, 移除 image_title"),o.setRangeOfNodeEnd(l.previousSibling),n.removeNode(l)}}}function Ne(e){return"img_container"===e.className}function Ce(e){return"image_title"===e.className}function Ee(e,t,o,n){console.log("%c执行 deleteFragment","color: #000000; background-color: #ffffff"),console.log("startContainer:",e,"\nstartOffset:",t,"\nendContainer:",o,"\nendOffset:",n);let{rangeApi:i,nodeApi:r}=this;if(e&&o){console.log("fragment 在 container 中");let l=r.getBlock(e),a=r.getPreBlock(l),s=r.getContainer(e),d=r.getContainer(o);if(Ne(s))if(console.log("startContainer 在 img_container 中"),0===t){console.log("startOffset 偏移量为 0");let e=this.executeHelpEvent(a,this.helpEventType.getLastContainer,[a]);i.setRangeOfNodeEnd(e),r.removeNode(l)}else{if(!Ce(d))throw new Error("不知道的情况, 需要完善");if(console.log("endContainerNode 在 image_title 中"),o.nodeType===Node.TEXT_NODE)console.log("endContainer 类型为 TEXT_NODE"),n===o.length?(console.log("移除 image_title"),i.setRangeOfNodeEnd(d.previousSibling),r.removeNode(d)):(console.log("删除 text 部分内容"),i.setRangeOfNodeEnd(d.previousSibling),o.deleteData(0,n));else if(o.nodeType===Node.ELEMENT_NODE){if(console.log("endContainer 类型为 ELEMENT_NODE"),o!==d)throw console.log("endContainer:",o,"\nendContainerNode:",d),new Error("按道理 endContainer 和 endContainerNode 应该相等");if(0!==n)throw new Error("不知道的情况, 需要完善");0===o.childNodes.length?(console.log("endContainer 节点为空, 移除 image_title"),i.setRangeOfNodeEnd(d.previousSibling),r.removeNode(o)):(console.log("endContainer 存在节点"),i.setRangeOfNodeEnd(d.previousSibling))}}else{if(!Ce(s))throw new Error("不知道的情况, 需要完善");if(console.log("startContainer 在 image_title 中"),!Ce(d))throw new Error("不知道的情况, 需要完善");if(console.log("endContainerNode 在 image_title 中"),o.nodeType!==Node.TEXT_NODE)throw new Error("目前 image_title 只允许 TEXT_NODE, 应该不会有别的类型节点存在");0===t&&n===o.length?(console.log("删空 text"),i.setCollapsedRange(d,0),r.removeNode(o)):(console.log("删除 text 部分内容"),i.setCollapsedRange(o,t),o.deleteData(t,n-t))}}else if(e){console.log("container 后半部分在 fragment 中, 需要选择 range");let o=r.getBlock(e),n=r.getPreBlock(o),l=r.getContainer(e);if(Ne(l))if(console.log("startContainer 在 img_container 中"),0===t){console.log("startOffset 偏移量为 0, 移除 imageBlock");let e=this.executeHelpEvent(n,this.helpEventType.getLastContainer,[n]);i.setRangeOfNodeEnd(e),r.removeNode(o)}else{if(1!==t)throw new Error("不知道的情况, 需要完善");console.log("startOffset 偏移量为 1"),i.setCollapsedRange(e,t),l.nextSibling&&r.removeNode(l.nextSibling)}else{if(!Ce(l))throw new Error("不知道的情况, 需要完善");if(console.log("startContainerNode 在 image_title 中"),e.nodeType===Node.TEXT_NODE)console.log("startContainer 类型为 TEXT_NODE"),0===t?(console.log("startOffset 偏移量为 0, 删空 text"),i.setCollapsedRange(l,0),r.removeNode(e)):(console.log("删除 text 部分内容"),i.setCollapsedRange(e,t),e.deleteData(t,e.length-t));else{if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("不知道的情况, 需要完善");if(console.log("startContainer 类型为 ELEMENT_NODE"),e!==l||0!==e.childNodes.length||0!==t)throw new Error("startContainer 的节点应该为空, 不应该打印此信息");i.setCollapsedRange(e,t)}}}else if(o){console.log("container 前半部分在 fragment 中, 不需要选择 range");let e=r.getBlock(o),t=r.getContainer(o);Ne(t)?(console.log("endContainer 在 img_container 中"),0===n?console.log("endOffset 偏移量为 0, 不操作"):(console.log("移除 imageBlock"),r.removeNode(e))):Ce(t)&&(console.log("endContainer 在 image_title 中, 移除 imageBlock"),r.removeNode(e))}}function ye(e,t){console.log("%c执行 enter","color: #000000; background-color: #ffffff"),console.log("node:",e,"\noffset:",t);let{rangeApi:o,nodeApi:n}=this,i=n.getBlock(e),r=n.getNextBlock(i),l=n.getContainer(e);if(Ne(l))if(console.log("在 img_container 中"),l.nextSibling)if(console.log("image_title 存在"),0===t)o.setRangeOfNodeStart(l.nextSibling);else{if(1!==t)throw new Error("offset 应该是 0 或者 1");o.setRangeOfNodeEnd(l.nextSibling)}else{console.log("image_title 不存在, 生产 image_title");let e=we.call(this);n.appendChild(i,e),o.setCollapsedRange(e,0)}else{if(!Ce(l))throw new Error("image 内不应该有别的类型 container");if(console.log("在 image_title 中"),r){let e=this.executeHelpEvent(r,this.helpEventType.getLastContainer,[r]);o.setRangeOfNodeStart(e)}else{let e=this.objToDom(this.defualtBlockObj);n.insertAfter(e,i),o.setCollapsedRange(e,0)}}}function ve(e,t,o,n){console.log("%c执行 enterFragment","color: #000000; background-color: #ffffff"),console.log("startContainer:",e,"\nstartOffset:",t,"\nendContainer:",o,"\nendOffset:",n);let{rangeApi:i,nodeApi:r}=this;if(e&&o){console.log("fragment 在 container 中");let l=r.getBlock(e),a=r.getNextBlock(l),s=r.getContainer(e),d=r.getContainer(o);if(Ne(s))if(console.log("startContainer 在 img_container 中"),0===t){console.log("startOffset 偏移量为 0");let e=this.executeHelpEvent(a,this.helpEventType.getLastContainer,[a]);i.setRangeOfNodeStart(e),r.removeNode(l)}else{if(!Ce(d))throw new Error("不知道的情况, 需要完善");if(console.log("endContainerNode 在 image_title 中"),o.nodeType===Node.TEXT_NODE)if(console.log("endContainer 类型为 TEXT_NODE"),n===o.length){console.log("移除 image_title");let e=this.executeHelpEvent(a,this.helpEventType.getLastContainer,[a]);i.setRangeOfNodeStart(e),r.removeNode(d)}else console.log("删除 text 部分内容"),i.setCollapsedRange(o,n),o.deleteData(0,n);else if(o.nodeType===Node.ELEMENT_NODE){if(console.log("endContainer 类型为 ELEMENT_NODE"),o!==d)throw console.log("endContainer:",o,"\nendContainerNode:",d),new Error("按道理 endContainer 和 endContainerNode 应该相等");if(0!==n)throw new Error("不知道的情况, 需要完善");0===o.childNodes.length?(console.log("endContainer 节点为空, range 选择 endContainer"),i.setCollapsedRange(d,0)):(console.log("endContainer 存在节点 range 选择 endContainer中的 text 头部"),i.setRangeOfNodeStart(d))}}}else if(e){console.log("container 后半部分在 fragment 中, 不需要选择 range");let o=r.getBlock(e),n=r.getContainer(e);if(Ne(n))if(console.log("startContainer 在 img_container 中"),0===t){console.log("startOffset 偏移量为 0, 移除 imageBlock");this.executeHelpEvent(preBlock,this.helpEventType.getLastContainer,[preBlock]);r.removeNode(o)}else{if(1!==t)throw new Error("不知道的情况, 需要完善");console.log("startOffset 偏移量为 1"),n.nextSibling&&r.removeNode(n.nextSibling)}else{if(!Ce(n))throw new Error("不知道的情况, 需要完善");if(console.log("startContainerNode 在 image_title 中"),e.nodeType===Node.TEXT_NODE)console.log("startContainer 类型为 TEXT_NODE"),0===t?(console.log("startOffset 偏移量为 0, 删除 image_title"),r.removeNode(n)):(console.log("删除 text 部分内容"),e.deleteData(t,e.length-t));else{if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("不知道的情况, 需要完善");console.log("startContainer 类型为 ELEMENT_NODE 无操作")}}}else if(o){console.log("container 前半部分在 fragment 中, 需要选择 range");let e=r.getBlock(o),t=r.getNextBlock(e),l=r.getContainer(o);if(Ne(l))if(console.log("endContainer 在 img_container 中"),0===n)console.log("endOffset 偏移量为 0, range 选择 img_container 头部"),i.setRangeOfNodeStart(l);else{console.log("移除 imageBlock");let o=this.executeHelpEvent(t,this.helpEventType.getLastContainer,[t]);i.setRangeOfNodeStart(o),r.removeNode(e)}else if(Ce(l)){console.log("endContainer 在 image_title 中, 移除 imageBlock");let o=this.executeHelpEvent(t,this.helpEventType.getLastContainer,[t]);i.setRangeOfNodeStart(o),r.removeNode(e)}}}var be={deleteForward:me,deleteFragment:Ee,enter:ye,enterFragment:ve};function we(e){return this.nodeApi.createDom({nodeName:"div",attributes:{class:"image_title",[this.nodeLabel.container]:!0},children:e})}var Te={type:"image",event:be,toDom(e){return void 0===e.isBlock&&console.error("数据待修正",e),this.nodeApi.createDom({nodeName:"div",attributes:{class:"image",[this.nodeLabel.block]:!0},style:e.imageStyle,children:[{nodeName:"div",attributes:{class:"img_container",[this.nodeLabel.container]:!0},children:{nodeName:"img",attributes:{src:e.src},style:e.imgStyle}},{if:!!e.title,nodeName:"div",attributes:{class:"image_title",[this.nodeLabel.container]:!0},children:e.title}]})},toObj(e){let t=e.childNodes[0].childNodes[0],o=e.childNodes[1],n={isBlock:!0,type:"image",src:t.src},i=this.nodeApi.getNodeStyle(e),r=this.nodeApi.getNodeStyle(t);return o&&(n.title=o.innerText),i&&(n.imageStyle=i),r&&(n.imgStyle=r),n},helpEvent:{getFirstContainer(e){return imageBlock.childNodes[0]},getLastContainer(e){return e.childNodes[1]},getMergeContainer(e){return!1},getMergedNodes(e){return!1},mergedDeleteNode(e){return!1}}},Oe={type:"code",toDom(e){return this.nodeApi.createDom({nodeName:"div",attributes:{class:"code",[this.nodeLabel.block]:!0},children:[{nodeName:"div",attributes:{class:"code_container"},children:{nodeName:"code",attributes:{[this.nodeLabel.container]:!0},style:e.codeStyle,children:e.data}},{nodeName:"div",if:!!e.title,attributes:{class:"code_title",[this.nodeLabel.container]:!0},children:e.title}]})},toObj(e){let t=e.childNodes[0],o=t.childNodes[0],n=e.childNodes[1],i={type:"code",data:o.innerText},r=this.nodeApi.getNodeStyle(o);return n&&(i.title=n.innerText),r&&(i.codeStyle=r),i}};function xe(e,t){console.log("%c执行 deleteForwardOnStart","color: #000000; background-color: #ffffff"),console.log("node:",e,"\noffset:",t);let{rangeApi:o,nodeApi:n}=this,i=n.getContainer(e),r=n.getBlock(i),l=i.parentNode,a=l.childNodes[1],s=n.getNodeIndexOf(l);if(1===l.parentNode.childNodes.length&&0===a.childNodes.length){console.log("是 list 中的第一个且最后一个 li, 且 content 为空");let e=this.objToDom(this.defualtBlockObj);n.insertAfter(e,r),n.removeNode(r),o.setCollapsedRange(e,0)}else if(s===l.parentNode.childNodes.length-1&&0===a.childNodes.length)console.log("是 list 中的最后一个 li, 且 content 为空"),o.setRangeOfNodeEnd(l.previousSibling.childNodes[1]),n.removeNode(l);else if(Re(i)){console.log("在 label 中");let e=i.parentNode,t=n.getNodeIndexOf(e);if(console.log("是 list 中的第",t+1,"个 li"),0===t)_e.call(this,e),0===r.childNodes.length&&n.removeNode(r);else{let t=e.previousSibling.childNodes[1],o=i.nextSibling;Se.call(this,t,o)}}else if(Ae(i)){console.log("在 li_content 中");let e=i.parentNode,t=n.getNodeIndexOf(e);if(console.log("是 list 中的第",t+1,"个 li"),0===t)_e.call(this,e),0===r.childNodes.length&&n.removeNode(r);else{let t=e.previousSibling.childNodes[1],o=i;Se.call(this,t,o)}}}function _e(e){console.log("%c执行 mergeLiToPreBlock, 将第一个 li 与 前一个 block 合并","color: #000000; background-color: #ffffff"),console.log("li:",e);let{rangeApi:t,nodeApi:o}=this,n=o.getBlock(e),i=o.getPreBlock(n);if(i)if(console.log("存在前一个 block"),i.childNodes.length>0){console.log("前一个 block 存在内容节点"),t.setRangeOfNodeEnd(i);let r=i.childNodes[i.childNodes.length-1],l=e.childNodes[1].childNodes[0];o.appendChildren(i,e.childNodes[1].childNodes),o.mergeTwoNodes(r,l),o.removeNode(e),He(n)}else console.log("前一个 block 为空, 直接删除"),o.removeNode(i);else console.log("前一个 block 不存在, 无操作")}function Se(e,t){console.log("%c执行 mergeTwoLi, 合并两个 li","color: #000000; background-color: #ffffff"),console.log("preLiContent:",e,"liContent:",t);let{rangeApi:o,nodeApi:n}=this,i=n.getBlock(e);if(e.childNodes.length>0)if(console.log("前一个 li 的 li_content 存在内容节点"),t.childNodes.length>0){console.log("当前 li 的 li_content 存在内容节点");let r=e.childNodes[e.childNodes.length-1],l=t.childNodes[0];o.setRangeOfNodeEnd(e),n.appendChildren(e,t.childNodes),n.mergeTwoNodes(r,l),n.removeNode(t.parentNode),He(i)}else console.log("当前 li 的 li_content 为空"),o.setRangeOfNodeEnd(e),n.removeNode(t.parentNode);else console.log("前一个 li 的 li_content 为空"),t.childNodes.length>0?(console.log("当前 li 的 li_content 存在内容节点"),n.appendChildren(e,t.childNodes),o.setRangeOfNodeStart(e),n.removeNode(t.parentNode)):(console.log("当前 li 的 li_content 为空"),o.setCollapsedRange(e,0),n.removeNode(t.parentNode))}function Re(e){return"label"===e.className}function Ae(e){return"li_content"===e.className}function ke(e,t,o,n){console.log("%c执行 deleteFragment","color: #000000; background-color: #ffffff"),console.log("startContainer:",e,"\nstartOffset:",t,"\nendContainer:",o,"\nendOffset:",n);let{rangeApi:i,nodeApi:r}=this;if(e&&o){console.log("fragment 在 container 中");let l=r.getContainer(e),a=l.parentNode,s=r.getContainer(o),d=s.parentNode;if(l===s)console.log("range 在同一个 container 中"),i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端"),i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端, 清空 container"),i.setCollapsedRange(l,0),r.emptyAllChild(l)):(console.log("endContainer 光标不在 container 最未端"),ae.call(this,s,o,n))):(console.log("startContainer 光标不在 container 最前端"),i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端"),de.call(this,l,e,t)):(console.log("endContainer 光标不在 container 最未端"),se.call(this,l,e,t,o,n)));else if(a===d){if(console.log("range 在不同的 container 中, 但是在同一个 liContainer 中"),!Re(l)||!Ae(s))throw console.error("startContainerNode:",l,"\nendContainerNode:",s),new Error("这种情况 startContainer 应该咋 label, endContainer 应该在 liContainer 中, 不应该打印此信息");i.isStartInContainer(e,t)?(console.log("startContainer 光标在 label container 最前端, 删空 li label"),Le.call(this,a),i.setCollapsedRange(l,0)):i.isEndInContainer(e,t)?(console.log("startContainer 光标在 label container 最未端, 无操作"),i.setRangeOfNodeEnd(l)):(console.log("startContainer 光标在 label container 中间"),de.call(this,l,e,t)),i.isStartInContainer(o,n)?console.log("startContainer 光标在 li container 最前端, 无操作"):i.isEndInContainer(o,n)?(console.log("startContainer 光标在 li container 最未端, 删空 li content"),De.call(this,a)):(console.log("endContainer 光标在 li container 中间"),ae.call(this,s,o,n,!1))}else{console.log("range 在不同的 liContainer 中");while(a.nextSibling!==d)r.removeNode(a.nextSibling);i.isStartInContainer(e,t)?(r.emptyAllChild(l),i.setCollapsedRange(l,0)):i.isEndInContainer(e,t)?i.setRangeOfNodeEnd(l):de.call(this,l,e,t),Re(l)&&(console.log("startContainerNode 是 label"),De.call(this,a)),i.isStartInContainer(o,n)||(i.isEndInContainer(o,n)?r.emptyAllChild(s):ae.call(this,s,o,n,!1)),Ae(s)&&(console.log("endContainerNode 是 liContainer"),Le.call(this,d)),r.mergeTwoNodes(a.childNodes[1],d.childNodes[1]),r.removeNode(d)}He(a.parentNode)}else if(e){console.log("container 后半部分在 fragment 中, 需要选择 range");let o=r.getContainer(e),n=o.parentNode;while(n.nextSibling)r.removeNode(n.nextSibling);Re(o)?(console.log("startContainerNode 是 label"),De.call(this,n),i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端"),Le.call(this,n),i.setCollapsedRange(o,0)):i.isEndInContainer(e,t)?(console.log("startContainer 光标在 container 最未端"),i.setRangeOfNodeEnd(o)):(console.log("startContainer 光标在 container 中间"),de.call(this,o,e,t))):Ae(o)&&(console.log("startContainerNode 是 liContainer"),i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端"),De.call(this,n),i.setCollapsedRange(o,0)):i.isEndInContainer(e,t)?(console.log("startContainer 光标在 container 最未端"),i.setRangeOfNodeEnd(o)):(console.log("startContainer 光标在 container 中间"),de.call(this,o,e,t)))}else{if(!o)throw console.error("startContainer:",e,"startOffset:",t,"endContainer:",o,"endOffset:",n),new Error("不知道的特殊情况");{console.log("container 前半部分在 fragment 中, 不需要选择 range");let e=r.getContainer(o),t=e.parentNode;while(t.previousSibling)r.removeNode(t.previousSibling);Re(e)?(console.log("endContainerNode 是 label"),i.isStartInContainer(o,n)?console.log("endContainerNode 光标在 container 最前端"):i.isEndInContainer(o,n)?(console.log("endContainerNode 光标在 container 最未端"),Le.call(this,t)):(console.log("endContainerNode 光标在 container 中间"),ae.call(this,e,o,n,!1))):Ae(e)&&(console.log("endContainerNode 是 liContainer"),Le.call(this,t),i.isStartInContainer(o,n)?console.log("endContainerNode 光标在 container 最前端"):i.isEndInContainer(o,n)?(console.log("endContainerNode 光标在 container 最未端"),De.call(this,t)):(console.log("endContainerNode 光标在 container 中间"),ae.call(this,e,o,n,!1)))}}}function De(e){this.nodeApi.emptyAllChild(e.childNodes[1])}function Le(e){this.nodeApi.emptyAllChild(e.childNodes[0])}function Ie(e,t){console.log("%c执行 enter","color: #000000; background-color: #ffffff"),console.log("node:",e,"\noffset:",t);let{rangeApi:o,nodeApi:n}=this,i=n.getContainer(e),r=i.parentNode,l=r.childNodes[1],a=n.getNodeIndexOf(r),s=n.getBlock(i),d=Fe.call(this,s.getAttribute("label")),c=d.childNodes[1];if(a===r.parentNode.childNodes.length-1&&0===l.childNodes.length){console.log("是 list 中的最后一个 li, 且 content 为空");let e=this.objToDom(this.defualtBlockObj);n.removeNode(r),n.insertAfter(e,s),o.setCollapsedRange(e,0)}else if(Re(i))console.log("在 label 中, 无操作");else if(Ae(i))if(console.log("在 liContent 中"),o.isStartInContainer(e,t))console.log("在 liContent 头部"),n.insertBefore(d,r);else if(o.isEndInContainer(e,t))console.log("在 liContent 末端"),n.insertAfter(d,r),o.setCollapsedRange(c,0);else{console.log("需要拆分 liContent:",l);let i=n.splitFromNodeOffsetStillTop(e,t,l);n.appendChildren(c,i.childNodes),n.insertAfter(d,r),o.setRangeOfNodeStart(c)}He(s)}function Me(e,t,o,n){console.log("%c执行 enterFragment","color: #000000; background-color: #ffffff"),console.log("startContainer:",e,"\nstartOffset:",t,"\nendContainer:",o,"\nendOffset:",n);let{rangeApi:i,nodeApi:r}=this;if(e&&o){console.log("fragment 在 container 中");let l=r.getContainer(e),a=l.parentNode,s=r.getContainer(o),d=s.parentNode,c=l.parentNode,g=c.childNodes[1],p=r.getBlock(c),h=Fe.call(this,p.getAttribute("label")),f=h.childNodes[1];if(l===s)if(console.log("range 在同一个 container 中"),r.insertAfter(h,c),He(p),i.isStartInContainer(e,t))console.log("startContainer 光标在 container 最前端"),i.isEndInContainer(o,n)?(console.log("endContainer 光标在 container 最未端, 清空 container"),r.emptyAllChild(g),i.setCollapsedRange(f,0)):(console.log("endContainer 光标不在 container 最未端"),ae.call(this,s,o,n,!1),r.appendChildren(f,g.childNodes),i.setRangeOfNodeStart(f));else if(console.log("startContainer 光标不在 container 最前端"),i.isEndInContainer(o,n))console.log("endContainer 光标在 container 最未端"),de.call(this,l,e,t,!1),He(p),i.setCollapsedRange(f,0);else{console.log("endContainer 光标不在 container 最未端");let a=r.splitFromNodeOffsetStillTop(o,n,s);r.splitFromNodeOffsetStillTop(e,t,l),r.appendChildren(f,a.childNodes),i.setRangeOfNodeStart(f)}else if(a===d){if(console.log("range 在不同的 container 中, 但是在同一个 liContainer 中"),r.insertAfter(h,c),He(p),!Re(l)||!Ae(s))throw console.error("startContainerNode:",l,"\nendContainerNode:",s),new Error("这种情况 startContainer 应该咋 label, endContainer 应该在 liContainer 中, 不应该打印此信息");if(i.isStartInContainer(e,t)?(console.log("startContainer 光标在 label container 最前端, 删空 li label"),Le.call(this,l)):i.isEndInContainer(e,t)?console.log("startContainer 光标在 label container 最未端, 无操作"):(console.log("startContainer 光标在 label container 中间"),de.call(this,l,e,t)),i.isStartInContainer(o,n))console.log("endContainer 光标在 li container 最前端"),r.appendChildren(f,g.childNodes),i.setRangeOfNodeStart(f);else if(i.isEndInContainer(o,n))console.log("startContainer 光标在 li container 最未端"),r.emptyAllChild(g),i.setCollapsedRange(f,0);else{console.log("endContainer 光标在 li container 中间");let e=r.splitFromNodeOffsetStillTop(o,n,s);r.emptyAllChild(g),r.appendChildren(f,e.childNodes),i.setRangeOfNodeStart(f)}}else{console.log("range 在不同的 liContainer 中");while(a.nextSibling!==d)r.removeNode(a.nextSibling);i.isStartInContainer(e,t)?r.emptyAllChild(l):i.isEndInContainer(e,t)||de.call(this,l,e,t,!1),Re(l)&&(console.log("startContainerNode 是 label"),De.call(this,a)),i.isStartInContainer(o,n)?i.setRangeOfNodeStart(s):i.isEndInContainer(o,n)?(r.emptyAllChild(s),i.setCollapsedRange(s,0)):ae.call(this,s,o,n),Ae(s)&&(console.log("endContainerNode 是 liContainer"),Le.call(this,d))}}else if(e){console.log("container 后半部分在 fragment 中, 不需要选择 range");let o=r.getContainer(e),n=o.parentNode;while(n.nextSibling)r.removeNode(n.nextSibling);Re(o)?(console.log("startContainerNode 是 label"),De.call(this,n),i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端"),Le.call(this,n)):i.isEndInContainer(e,t)?console.log("startContainer 光标在 container 最未端"):(console.log("startContainer 光标在 container 中间"),de.call(this,o,e,t))):Ae(o)&&(console.log("startContainerNode 是 liContainer"),i.isStartInContainer(e,t)?(console.log("startContainer 光标在 container 最前端"),De.call(this,n)):i.isEndInContainer(e,t)?console.log("startContainer 光标在 container 最未端"):(console.log("startContainer 光标在 container 中间"),de.call(this,o,e,t,!1)))}else{if(!o)throw console.error("startContainer:",e,"startOffset:",t,"endContainer:",o,"endOffset:",n),new Error("不知道的特殊情况");{console.log("container 前半部分在 fragment 中, 需要选择 range");let e=r.getContainer(o),t=e.parentNode;while(t.previousSibling)r.removeNode(t.previousSibling);Re(e)?(console.log("endContainerNode 是 label"),i.isStartInContainer(o,n)?(console.log("endContainerNode 光标在 container 最前端"),e.childNodes.length?i.setRangeOfNodeStart(e):i.setCollapsedRange(e,0)):i.isEndInContainer(o,n)?(console.log("endContainerNode 光标在 container 最未端"),Le.call(this,t),i.setCollapsedRange(e,0)):(console.log("endContainerNode 光标在 container 中间"),ae.call(this,e,o,n))):Ae(e)&&(console.log("endContainerNode 是 liContainer"),Le.call(this,t),i.isStartInContainer(o,n)?(console.log("endContainerNode 光标在 container 最前端"),e.childNodes.length?i.setRangeOfNodeStart(e):i.setCollapsedRange(e,0)):i.isEndInContainer(o,n)?(console.log("endContainerNode 光标在 container 最未端"),De.call(this,t),i.setCollapsedRange(e,0)):(console.log("endContainerNode 光标在 container 中间"),ae.call(this,e,o,n)))}}}var je={deleteForward:ne,deleteForwardOnStart:xe,deleteFragment:ke,enter:Ie,enterFragment:Me},Be={type:"list",event:je,toDom(e){return this.nodeApi.createDom({nodeName:"div",attributes:{class:"list",label:Array.isArray(e.label)?"custom":e.label,[this.nodeLabel.block]:!0},children:e.data.map(((t,o)=>Pe.call(this,e.label,o,t)))})},toObj(e){let t={type:"list",label:e.getAttribute("label"),data:[]};return"custom"===t.label&&(t.label=[]),e.childNodes.forEach((e=>{let o=[];Array.isArray(t.label)&&t.label.push(e.childNodes[0].innerText),e.childNodes[1].childNodes.forEach((e=>{o.push(this.domToObj(e))})),t.data.push(o)})),t},helpEvent:{getFirstContainer(e){return e.childNodes[0].childNodes[1]},getLastContainer(e){return e.childNodes[e.childNodes.length-1].childNodes[1]},getMergeContainer(e){return e.childNodes[e.childNodes.length-1].childNodes[1]},getMergedNodes(e){return e.childNodes[0].childNodes[1].childNodes},mergedDeleteNode(e){return e.childNodes.length>1?(setTimeout((()=>{He(e)}),0),e.childNodes[0]):e}}};function Pe(e,t,o){return{nodeName:"div",attributes:{class:"li"},children:[{nodeName:"div",attributes:{class:"label",contenteditable:!(!Array.isArray(e)&&"custom"!==e)&&null,[this.nodeLabel.container]:!(!Array.isArray(e)&&"custom"!==e)||null},children:Ve(t,e)},{nodeName:"div",attributes:{class:"li_content",[this.nodeLabel.container]:!0},created:e=>{Array.isArray(o)&&o.forEach((t=>{let o=this.objToDom(t);o&&e.appendChild(o)}))}}]}}function Fe(e){return this.nodeApi.createDom({nodeName:"div",attributes:{class:"li"},children:[{nodeName:"div",attributes:{class:"label",contenteditable:"custom"===e||"false",[this.nodeLabel.container]:"custom"===e||null}},{nodeName:"div",attributes:{class:"li_content",[this.nodeLabel.container]:!0}}]})}function Ve(e,t){return"disorderly"===t?"·":"english"===t?String.fromCharCode(97+e)+".":"English"===t?String.fromCharCode(65+e)+".":"number"===t?1+e+".":Array.isArray(t)?t[e]:"custom"===t?"":void 0}function He(e,t){let o;console.log("resetListLabel block:",e,"\nlabelType:",t),t?(o=e.getAttribute("label"),e.setAttribute("label",t)):t=e.getAttribute("label"),"custom"===t?e.childNodes.forEach(((e,t)=>{let n=e.childNodes[0];if(n.setAttribute("container",!0),n.contentEditable=!0,o&&"custom"!==o)for(let o=n.childNodes.length-1;o>=0;o--)n.removeChild(n.childNodes[o])})):e.childNodes.forEach(((e,n)=>{if("custom"===o){let t=e.childNodes[0];t.removeAttribute("container"),t.contentEditable=!1}e.childNodes[0].innerText=Ve(n,t)}))}var Xe={type:"text",toDom(e){if(e.data.indexOf("\\n")>-1)throw console.error(data),new Error("text 内存在换行信息");return" "===e.data&&console.error("存在空字符串"),this.nodeApi.createTextNode(e.data)},toObj(e){return{type:"text",data:e.nodeValue}}},$e=(o(2801),{type:"mathjax",toDom(e){return e.style&&delete e.style.height,this.nodeApi.createDom({nodeName:"img",attributes:{class:"mathjax",tex:e.data,src:"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent((new XMLSerializer).serializeToString(MathJax.tex2svg(e.data).childNodes[0]))))},style:{...e.style,"max-height":e.style&&e.style.display?"initial":null}})},toObj(e){let t={type:"mathjax",data:e.getAttribute("tex")},o=this.nodeApi.getNodeStyle(e);return o&&(t.style=o),t}});function Ue(e,t){let o=r[e];if(o){if(o.event&&o.event[t])return o.event[t];throw console.error("组件名",e,"组件:",o,"事件类型:",t,"事件:",o.event),new Error("该事件未完善")}throw console.error("组件名",e),new Error("不存在该组件")}function ze(e,t){let o=r[e];if(o){if(o.helpEvent&&o.helpEvent[t])return o.helpEvent[t];throw console.error("组件名",e,"辅助事件:",t),new Error("该辅助事件未完善")}throw console.error("组件名",e),new Error("不存在该组件")}function Ze(e,t){if("object"!==typeof t)throw console.error("obj",t),new Error("输入参数出错");if(!r[t.type])throw console.error("obj",t),new Error("该类型组件不存在");return r[t.type].toDom.call(e,t)}function Je(e,t){if("object"!==typeof t)throw console.error("obj",obj),new Error("输入参数出错");if(t.nodeType===Node.TEXT_NODE)return Xe.toObj.call(e,t);if(t.nodeType===Node.ELEMENT_NODE){if(!r[t.className])throw console.error("dom:",t),new Error("该类型组件不存在");return r[t.className].toObj.call(e,t)}throw console.error("dom:",t),new Error("不知道的特殊情况")}function We(e){if(e.ctrlKey||e.metaKey){if(67===e.keyCode)return;if(86===e.keyCode)return;if(83===e.keyCode)return}let t=!0;switch(e.keyCode){case 8:this.deleteForward();break;case 46:this.deleteBackward();break;case 13:this.enter();break;case 37:case 38:case 39:case 40:t=!1;break;default:1===e.key.length&&229!==e.keyCode&&this.insertText(e.key);break}t&&e.preventDefault()}function qe(e){console.log("compositionstart:",e);let t=this.rangeApi.getRange(),{collapsed:o,startContainer:n,startOffset:i,endContainer:r,endOffset:l}=t;this.event.compositionStartRange.collapsed=o,this.event.compositionStartRange.startContainer=n,this.event.compositionStartRange.startOffset=i,this.event.compositionStartRange.endContainer=r,this.event.compositionStartRange.endOffset=l}function Ge(e){console.log("compositionstart:",e),console.log("compositionStartRange:",this.event.compositionStartRange.collapsed),console.log("compositionStartRange:",this.event.compositionStartRange.startContainer),console.log("compositionStartRange:",this.event.compositionStartRange.startOffset),console.log("compositionStartRange:",this.event.compositionStartRange.endContainer),console.log("compositionStartRange:",this.event.compositionStartRange.endOffset),console.log("this:",this)}function Ke(e){e.preventDefault(),console.log("handleOnPaste:",e),console.log("犯懒了, 目前只支持 text");let t=(e.clipboardData||window.clipboardData).getData("text");this.insertText(t)}class Ye{constructor(e){this.editor=e,this.keydown=We.bind(e),e.editorDom.addEventListener("keydown",this.keydown),this.compositionStartRange={},this.compositionstart=qe.bind(e),e.editorDom.addEventListener("compositionstart",this.compositionstart),this.compositionend=Ge.bind(e),e.editorDom.addEventListener("compositionend",this.compositionend),this.paste=Ke.bind(e),e.editorDom.addEventListener("paste",this.paste),this.dragstart=function(e){e.preventDefault()},e.editorDom.addEventListener("dragstart",this.dragstart),this.drop=function(e){e.preventDefault()},e.editorDom.addEventListener("drop",this.drop)}destroy(){this.editor.editorDom.removeEventListener("keydown",this.keydown),this.keydown=null,this.compositionStartRange=null,this.editor.editorDom.removeEventListener("compositionstart",this.compositionstart),this.compositionstart=null,this.editor.editorDom.removeEventListener("compositionend",this.compositionend),this.compositionend=null,this.editor.editorDom.removeEventListener("paste",this.paste),this.paste=null,this.editor.editorDom.removeEventListener("dragstart",this.dragstart),this.dragstart=null,this.editor.editorDom.removeEventListener("drop",this.drop),this.drop=null,this.editor=null}}function Qe(e,t){this.editorDom=e,this.editorDom.style["white-space"]="pre-wrap",this.editorDom.setAttribute("editor",!0),this.lastRange={},this.event=new Ye(this),this.defualtBlockObj={type:"paragraph"}}Qe.prototype.init=function(){let e=this.objToDom(this.defualtBlockObj);return this.nodeApi.appendChild(this.editorDom,e),this.rangeApi.setNewCollapsedRange(e,0),this.setEditable(!0),this},Qe.prototype.destroy=function(){this.event.destroy(),this.event=null},Qe.prototype.setEditable=function(e){return this.editorDom.contentEditable=this.editable=e,this},Qe.prototype.recordRange=function(e){let{collapsed:t,startContainer:o,startOffset:n,endContainer:i,endOffset:r}=e;return this.lastRange.collapsed=t,this.lastRange.startContainer=o,this.lastRange.startOffset=n,this.lastRange.endContainer=i,this.lastRange.endOffset=r,this},Qe.prototype.rangeApi=Qe.rangeApi=i,Qe.prototype.nodeApi=Qe.nodeApi=n,Qe.prototype.nodeLabel=Qe.nodeLabel=g,Qe.prototype.render=function(e){return this.nodeApi.emptyAllChild(this.editorDom),e.blocks.forEach((e=>{let t=this.objToDom(e);if(!t)throw console.error("blockObj:",e),new Error("组件 dom 读取解析失败");this.nodeApi.appendChild(this.editorDom,t)})),this},Qe.prototype.empty=function(){this.nodeApi.emptyAllChild(this.editorDom)},Qe.prototype.toObj=function(){let e={blocks:[]};return this.editorDom.childNodes.forEach((t=>{let o=this.domToObj(t);if(!o)throw console.error("blockDom",t),new Error("block 转化失败");e.blocks.push(o)})),e},Qe.prototype.objToDom=function(e){return Ze(this,e)},Qe.prototype.domToObj=function(e){return Je(this,e)},Qe.prototype.loadJson=function(e,t){let o=new XMLHttpRequest,n=this;return o.onreadystatechange=function(){if(4==this.readyState&&200==this.status)try{let e=JSON.parse(this.responseText);n.render(e),"function"===typeof t&&t(e)}catch(e){n.init(),console.error("文件解析有问题",e)}},o.open("GET",e,!0),o.send(),this},Qe.prototype.exportObjJsonFormatting=function(e){let t=document.createElement("a");t.download=e,t.style.display="none";let o=new Blob([JSON.stringify(this.toObj(),null,4)]);return t.href=URL.createObjectURL(o),this.nodeApi.appendChild(document.body,t),t.click(),this.nodeApi.removeNode(t),this},Qe.prototype.helpEventType={getFirstContainer:"getFirstContainer",getLastContainer:"getLastContainer",getMergeContainer:"getMergeContainer",getMergedNodes:"getMergedNodes",mergedDeleteNode:"mergedDeleteNode"},Qe.prototype.executeHelpEvent=function(e,t,o){if(this.nodeApi.isNotBlock(e))throw console.error("block:",e),new Error("executeHelpEvent 传参错误, 不是 block");let n=ze(e.className,t);if(n)return n.apply(this,o);throw new Error(`${eventKey} 组件 ${t} 辅助事件未完善`)},Qe.prototype.eventType={deleteForward:"deleteForward",deleteForwardOnStart:"deleteForwardOnStart",deleteFragment:"deleteFragment",enter:"enter",enterFragment:"enterFragment"},Qe.prototype.executeEditorEvent=function(e,t,o){if(this.nodeApi.isNotBlock(e))throw console.error("block:",e),new Error("executeEditorEvent 传参错误, 不是 block");let n=Ue(e.className,t);if(!n)throw new Error(`${eventKey} 组件 ${t} 事件未完善`);n.apply(this,o)},Qe.prototype.deleteForward=function(){console.clear(),console.log("deleteForward");let{rangeApi:e,nodeApi:t}=this,o=e.getRange();if(!o)throw new Error("range 不存在, deleteForward 执行失败");let{collapsed:n,startContainer:i,startOffset:r,endContainer:l,endOffset:a}=o;if(n){let e=t.getBlock(i);this.executeEditorEvent(e,this.eventType.deleteForward,[i,r])}else{let e=t.getBlock(i),o=t.getBlock(l);if(e===o)console.log("在同一个 block 中"),this.executeEditorEvent(e,this.eventType.deleteFragment,[i,r,l,a]);else{console.log("在不同的 block 中");while(e.nextSibling!==o)this.nodeApi.removeNode(e.nextSibling);this.executeEditorEvent(e,this.eventType.deleteFragment,[i,r,void 0,void 0]),this.executeEditorEvent(o,this.eventType.deleteFragment,[void 0,void 0,l,a]),this.mergeTwoBlocks(e,o)}}},Qe.prototype.mergeTwoBlocks=function(e,t){console.log("%cEditor mergeTwoBlocks","color: #000000; background-color: #ffffff"),console.log("preBlock:",e,"\nblock:",t);let{rangeApi:o,nodeApi:n}=this,i=this.executeHelpEvent(e,this.helpEventType.getMergeContainer,[e]),r=this.executeHelpEvent(t,this.helpEventType.getMergedNodes,[t]),l=this.executeHelpEvent(t,this.helpEventType.mergedDeleteNode,[t]);if(i)if(console.log("前一个 block 存在能够合并的容器:",i),r){console.log("当前 block 存在用于合并的节点:",r);let e=i.childNodes[i.childNodes.length-1],t=r[0];e?(console.log("前一个 block 存在最后一个节点:",e),t?(console.log("当前 block 存在第一个节点:",t),n.appendChildren(i,r),n.mergeTwoNodes(e,t),l&&n.removeNode(l)):(console.log("当前 block 不存在第一个节点, 为空"),l&&n.removeNode(l))):(console.log("前一个 block 不存在最后一个节点, 为空"),t?(console.log("当前 block 存在第一个节点:",t),n.appendChildren(i,r),l&&n.removeNode(l)):(console.log("当前 block 不存在第一个节点, 为空"),l&&n.removeNode(l)))}else console.log("当前 block 不存在用于合并的节点");else console.log("前一个 block 不存在能够合并的容器")},Qe.prototype.deleteBackward=function(){console.clear();let{rangeApi:e,nodeApi:t}=this,o=e.getRange();if(!o)throw new Error("range 不存在, deleteBackward 执行失败");let{collapsed:n,startContainer:i,startOffset:r,endContainer:l,endOffset:a}=o},Qe.prototype.enter=function(){console.clear();let{rangeApi:e,nodeApi:t}=this,o=e.getRange();if(!o)throw new Error("range 不存在, enter 执行失败");let{collapsed:n,startContainer:i,startOffset:r,endContainer:l,endOffset:a}=o;if(n){let e=t.getBlock(i);this.executeEditorEvent(e,this.eventType.enter,[i,r])}else{let e=t.getBlock(i),o=t.getBlock(l);if(e===o){console.log("在同一个 block 中");let e=t.getBlock(i);this.executeEditorEvent(e,this.eventType.enterFragment,[i,r,l,a])}else{console.log("在不同的 block 中");while(e.nextSibling!==o)this.nodeApi.removeNode(e.nextSibling);this.executeEditorEvent(e,this.eventType.enterFragment,[i,r,void 0,void 0]),this.executeEditorEvent(o,this.eventType.enterFragment,[void 0,void 0,l,a])}}},Qe.prototype.insertText=function(e,t){t||console.clear(),console.log("insertText:",e);let{rangeApi:o,nodeApi:n}=this,i=o.getRange();if(!i)throw new Error("range 不存在, insertText 执行失败");let{collapsed:r,startContainer:l,startOffset:a,endContainer:s,endOffset:d}=i;if(r){console.log("startContainer:",l,"\nstartOffset:",a);let t=n.getContainer(l);if(n.allowLine(t)||(console.log("不允许换行"),e=e.replace(/\n/g," ")),l.nodeType===Node.TEXT_NODE)console.log("在 text 内插入字符"),l.insertData(a,e),o.setCollapsedRange(l,a+e.length);else if(l.nodeType===Node.ELEMENT_NODE)if(0===l.childNodes.length&&0===a){if(!n.isContainer(l))throw new Error("不知道的特殊情况, 按道理应该是 container 容器才是");{console.log("在一个空的 container 内");let t=n.createTextNode(e);n.appendChild(l,t),o.setCollapsedRange(t,e.length)}}else if(l.nodeType===Node.ELEMENT_NODE)if(console.log("在元素内插入字符"),0===a){console.log("startOffset 为 0");let t=l.childNodes[0],i=n.getStartLeafNode(t),r=n.getPreLeafNodeInContainer(t),a=n.createTextNode(e);if(console.log("element:",t,"\nleafNode:",i,"\npreLeafNode:",r),r&&r.nodeType===Node.TEXT_NODE)console.log("preLeafNode 是 text"),r.insertData(r.length,e),o.setCollapsedRange(r,r.length);else if(i.nodeType===Node.TEXT_NODE)console.log("preLeafNode 是 node, , leafNode 是 text"),i.insertData(0,e),o.setCollapsedRange(i,e.length);else{console.log("leafNode 是 node, preLeafNode 也是 node (或者不存在)");let i=t,r=i.parentNode;while(n.isNotContainer(r)&&!i.previousSibling)i=r,r=i.parentNode;n.insertBefore(a,i),o.setCollapsedRange(a,e.length)}}else{console.log("startOffset 不为 0");let t=l.childNodes[a-1],i=n.getEndLeafNode(t),r=n.getNextLeafNodeInContainer(t),s=n.createTextNode(e);if(console.log("element:",t,"\nleafNode:",i,"\nnextLeafNode:",r),i.nodeType===Node.TEXT_NODE)console.log("leafNode 是 text"),i.insertData(i.length,e),o.setCollapsedRange(i,i.length);else if(r&&r.nodeType===Node.TEXT_NODE)console.log("leafNode 是 node, nextLeafNode 是 text"),r.insertData(0,e),o.setCollapsedRange(r,e.length);else{console.log("leafNode 是 node, nextLeafNode 也是 node (或者不存在)");let i=t,r=i.parentNode;while(n.isNotContainer(r)&&!i.nextSibling)i=r,r=i.parentNode;n.insertAfter(s,i),o.setCollapsedRange(s,e.length)}}}else this.deleteForward(),this.insertText(e,!0)},Qe.prototype.insertElement=function(e,t){console.log("insertElement:",e);let{rangeApi:o,nodeApi:n}=this,i=o.getRange();if(this.editorDom.contains(i.startContainer)||(i=this.lastRange),!i)throw new Error("range 不存在, insertElement 执行失败");let{collapsed:r,startContainer:l,startOffset:a,endContainer:s,endOffset:d}=i;if(r)if(console.log("startContainer:",l,"\nstartOffset:",a),l.nodeType===Node.TEXT_NODE)if(console.log("在 text 内插入元素"),a===l.length){console.log("在 text 末端");let t=l,i=t.parentNode;while(n.isNotContainer(i)&&!t.nextSibling)t=i,i=t.parentNode;let r=n.getNodeIndexOf(t);if(NodeList.prototype.isPrototypeOf(e)||Array.prototype.isPrototypeOf(e)){for(let o=e.length-1;o>=0;o--)n.insertAfter(e[o],t);o.setCollapsedRange(i,r+e.length+1)}else n.insertAfter(e,t),o.setNewCollapsedRange(i,r+2)}else console.error("犯懒了, 暂不支持此操作");else l.nodeType===Node.ELEMENT_NODE&&console.error("犯懒了, 暂不支持此操作");else console.error("犯懒了, 暂不支持此操作")},Qe.prototype.format=function(e){},Qe.prototype.resetListLabel=He;var et=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tooltip"},[t("div",{staticClass:"button",attrs:{"data-not-allow":e.rangeNotInEditor}},[t("div",{staticClass:"title iconfont icon-json",attrs:{title:"导出json"},on:{mousedown:e.exportJson}})]),t("div",{staticClass:"divider"}),t("div",{staticClass:"button header_paragraph_type",attrs:{"data-not-allow":null===e.headerParagraphType}},[t("div",{staticClass:"title"},[t("div",{staticClass:"now_type_name"},[e._v(e._s(e.headerParagraphType))]),t("div",{staticClass:"iconfont icon-caozuozhankai"}),t("div",{staticClass:"all_types_container"},[t("div",{staticClass:"all_types"},[t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.setHeaderParagraph("paragraph")}}},[e._v(" 正文 ")]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.setHeaderParagraph("h1")}}},[t("h1",[e._v("标题1")])]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.setHeaderParagraph("h2")}}},[t("h2",[e._v("标题2")])]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.setHeaderParagraph("h3")}}},[t("h3",[e._v("标题3")])]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.setHeaderParagraph("h4")}}},[t("h4",[e._v("标题4")])])])])])]),t("div",{staticClass:"button",attrs:{"data-not-allow":e.rangeNotInEditor}},[t("div",{staticClass:"title iconfont icon-fsux_tubiao_gongshi_jisuan",attrs:{title:"添加数学公式"},on:{mousedown:e.addMathjax}})]),t("v-mathjaxOperation",{attrs:{tooltipMessage:e.tooltipMessage}}),t("div",{staticClass:"button list",attrs:{"data-not-allow":e.rangeNotInEditor}},[t("div",{staticClass:"title iconfont icon-liebiaomoshi",attrs:{title:"添加列表"}},[t("div",{staticClass:"all_types_container"},[t("div",{staticClass:"all_types"},[t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.listOperation("disorderly")}}},[e._v(" 无序列表 ")]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.listOperation("english")}}},[e._v(" 小写英语 ")]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.listOperation("English")}}},[e._v(" 大写英语 ")]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.listOperation("number")}}},[e._v(" 数字序列 ")]),t("div",{staticClass:"type_name",on:{mouseup:function(t){return e.listOperation("custom")}}},[e._v(" 自定义 ")])])])])]),t("div",{staticClass:"button",attrs:{"data-not-allow":e.rangeNotInEditor}},[t("div",{staticClass:"title iconfont icon-tupian",attrs:{title:"添加图片"},on:{mousedown:e.addImage}})]),t("v-imageOperation",{attrs:{tooltipMessage:e.tooltipMessage}}),t("div",{staticClass:"button",attrs:{"data-not-allow":e.rangeNotInEditor}},[t("div",{staticClass:"title iconfont icon-yuandaimaxiayoudaima",attrs:{title:"添加代码"}})])],1)},tt=[];function ot(e){console.clear(),console.log("setHeaderParagraph type:",e);let t=this.editor,o=t.rangeApi.getRange();if(o){let n,{startContainer:i,startOffset:r,endContainer:l,endOffset:a}=o,s=t.nodeApi.getBlock(o.startContainer);switch(e){case"h1":case"h2":case"h3":case"h4":n=t.objToDom({type:"header",level:e});break;case"paragraph":n=t.objToDom({type:"paragraph"});break}i===s&&(i=n),l===s&&(l=n),t.nodeApi.appendChildren(n,s.childNodes),t.nodeApi.insertAfter(n,s),t.editorDom.removeChild(s),t.rangeApi.setNewRange(i,r,l,a)}}function nt(e){console.clear(),console.log("addList labelType:",e);let t=this.editor,o=t.rangeApi.getRange();if(o&&o.collapsed){let n,{startContainer:i,startOffset:r,endContainer:l,endOffset:a}=o,s=t.nodeApi.getBlock(o.startContainer);if(console.log("startContainer:",i),console.log("startOffset:",r),"list"===s.className){let o=s.getAttribute("label");if("custom"===o){let e=t.nodeApi.getContainer(i);"label"===e.className?e.nextSibling.childNodes.length?t.rangeApi.setRangeOfNodeStart(e.nextSibling,!0):t.rangeApi.setNewCollapsedRange(e.nextSibling,0):t.rangeApi.setNewCollapsedRange(i,r)}else t.rangeApi.setNewCollapsedRange(i,r);t.resetListLabel(s,e)}else n=t.objToDom({type:"list",label:e,data:[[]]}),t.nodeApi.insertAfter(n,s),t.rangeApi.setNewCollapsedRange(n.childNodes[0].childNodes[1],0),console.log("block.childNodes[0].childNodes[1]:",n.childNodes[0].childNodes[1])}}var it=o(8296),rt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tooltip-operation image_operation",attrs:{"data-show":e.tooltipMessage.imageOperationShow},on:{mousedown:e.cancelOperation}},[t("div",{staticClass:"operatoin",on:{mousedown:function(e){e.stopPropagation()}}},[t("div",{staticClass:"image_preview",on:{dragstart:function(e){e.preventDefault()},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),e.dropImageFile.apply(null,arguments)}}},[e.tooltipMessage.imageBase64?t("img",{attrs:{id:"showImage",src:e.tooltipMessage.imageBase64}}):t("div",{staticClass:"title"},[e._v("拖拽预览")])]),t("div",{staticClass:"image_title"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.tooltipMessage.imageTitle,expression:"tooltipMessage.imageTitle"}],ref:"imageTitle",attrs:{type:"text",placeholder:"图片标题"},domProps:{value:e.tooltipMessage.imageTitle},on:{input:function(t){t.target.composing||e.$set(e.tooltipMessage,"imageTitle",t.target.value)}}})]),t("div",{staticClass:"buttons"},[t("div",{staticClass:"button"},[t("input",{attrs:{type:"file"},on:{change:e.readImageFile}}),e._v(" 导入 ")]),t("div",{staticClass:"button",on:{mousedown:e.clearOperation}},[e._v("清空")]),t("div",{staticClass:"button",on:{mousedown:e.confirmOperation}},[e._v("确定")]),t("div",{staticClass:"button",on:{mousedown:e.cancelOperation}},[e._v("取消")])])])])},lt=[],at={props:{tooltipMessage:{type:Object,default(){return{}}}},methods:{dropImageFile(e){let t=e.dataTransfer.files,o=t[0],n=new FileReader;n.onload=()=>{this.tooltipMessage.imageBase64=n.result},n.readAsDataURL(o)},readImageFile(e){let t=e.target.files,o=t[0],n=new FileReader;n.onload=()=>{this.tooltipMessage.imageBase64=n.result},n.readAsDataURL(o)},clearOperation(e){this.tooltipMessage.imageBase64=null,this.tooltipMessage.imageTitle=null,this.tooltipMessage.imageStyle=null,this.tooltipMessage.imgStyle=null},confirmOperation(){let{editor:e,imageBase64:t,imageTitle:o,imgStyle:n}=this.tooltipMessage,i=e.lastRange,r=e.nodeApi.getBlock(i.endContainer),l=e.objToDom({type:"image",isBlock:!0,title:o,src:t,imageStyle:{"text-align":"center"},imgStyle:n});e.nodeApi.insertAfter(l,r),this.cancelOperation()},cancelOperation(){this.tooltipMessage.imageOperationShow=!1}}},st=at,dt=o(1001),ct=(0,dt.Z)(st,rt,lt,!1,null,null,null),gt=ct.exports,pt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tooltip-operation image_operation",attrs:{"data-show":e.tooltipMessage.mathjaxOperationShow},on:{mousedown:e.cancalMathjax}},[t("div",{staticClass:"operatoin",on:{mousedown:function(e){e.stopPropagation()}}},[t("div",{staticClass:"mathjax_img"},e._l(e.tooltipMessage.mathjaxTexs,(function(o,n){return t("img",{attrs:{src:e.getMathjaxBase64(o)}})})),0),t("div",{ref:"inputs",staticClass:"inputs"},e._l(e.tooltipMessage.mathjaxTexs,(function(o,n){return t("input",{directives:[{name:"model",rawName:"v-model",value:e.tooltipMessage.mathjaxTexs[n],expression:"tooltipMessage.mathjaxTexs[index]"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.tooltipMessage.mathjaxTexs[n]},on:{input:function(t){t.target.composing||e.$set(e.tooltipMessage.mathjaxTexs,n,t.target.value)}}})})),0),t("div",{staticClass:"styleMessage",attrs:{"data-show":e.styleMessageVisible}},[t("div",{staticClass:"message"},[t("div",{staticClass:"title"},[e._v("是否独立")]),t("div",{staticClass:"content"},[t("div",{staticClass:"checkbox",attrs:{"data-check":!!e.display},on:{mousedown:e.setStyleDisplay}},[t("div",{staticClass:"check"})])])]),t("div",{staticClass:"message"},[t("div",{staticClass:"title"},[e._v("上外间距")]),t("div",{staticClass:"content"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.marginTop,expression:"marginTop"}],staticClass:"text",attrs:{type:"text"},domProps:{value:e.marginTop},on:{input:function(t){t.target.composing||(e.marginTop=t.target.value)}}}),t("div",{staticClass:"unit"},[e._v("px")])]),t("div",{staticClass:"title"},[e._v("右外间距")]),t("div",{staticClass:"content"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.marginLeft,expression:"marginLeft"}],staticClass:"text",attrs:{type:"text"},domProps:{value:e.marginLeft},on:{input:function(t){t.target.composing||(e.marginLeft=t.target.value)}}}),t("div",{staticClass:"unit"},[e._v("px")])])]),t("div",{staticClass:"message"},[t("div",{staticClass:"title"},[e._v("下外间距")]),t("div",{staticClass:"content"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.marginBottom,expression:"marginBottom"}],staticClass:"text",attrs:{type:"text"},domProps:{value:e.marginBottom},on:{input:function(t){t.target.composing||(e.marginBottom=t.target.value)}}}),t("div",{staticClass:"unit"},[e._v("px")])]),t("div",{staticClass:"title"},[e._v("左外间距")]),t("div",{staticClass:"content"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.marginRight,expression:"marginRight"}],staticClass:"text",attrs:{type:"text"},domProps:{value:e.marginRight},on:{input:function(t){t.target.composing||(e.marginRight=t.target.value)}}}),t("div",{staticClass:"unit"},[e._v("px")])])])]),t("div",{staticClass:"buttons"},[t("div",{staticClass:"button",on:{mouseup:function(t){return e.setStyleMessageVisible(void 0)}}},[e._v("样式")]),t("div",{staticClass:"button",on:{mouseup:e.addMathjax}},[e._v("添加")]),t("div",{staticClass:"button",on:{mouseup:e.reduceMathjax}},[e._v("减少")]),t("div",{staticClass:"button",on:{mouseup:e.clearMathjax}},[e._v("清空")]),t("div",{staticClass:"button",on:{mouseup:e.confirmMathjax}},[e._v("确定")]),t("div",{staticClass:"button",on:{mouseup:e.cancalMathjax}},[e._v("取消")])])])])},ht=[],ft={data(){return{styleMessageVisible:!1,display:null,marginTop:null,marginLeft:null,marginBottom:null,marginRight:null}},props:{tooltipMessage:{type:Object,default(){return{}}}},watch:{"tooltipMessage.mathjaxStyle":function(e){console.log("newVal:",e),e?(this.setStyleMessageVisible(!0),e.display&&(this.display=e.display),e["margin-top"]&&(this.marginTop=e["margin-top"].split("px")[0]),e["margin-left"]&&(this.marginLeft=e["margin-left"].split("px")[0]),e["margin-bottom"]&&(this.marginBottom=e["margin-bottom"].split("px")[0]),e["margin-right"]&&(this.marginRight=e["margin-right"].split("px")[0])):this.setStyleMessageVisible(!1)}},methods:{setStyleMessageVisible(e){if(void 0===e?this.styleMessageVisible=!this.styleMessageVisible:e!==this.styleMessageVisible&&(this.styleMessageVisible=e),this.styleMessageVisible)while(this.tooltipMessage.mathjaxTexs.length>1)this.tooltipMessage.mathjaxTexs.splice(length-1,1)},setStyleDisplay(){this.display?this.display=null:this.display="block"},getMathjaxBase64(e){if(e)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent((new XMLSerializer).serializeToString(MathJax.tex2svg(e).childNodes[0]))))},addMathjax(){this.styleMessageVisible&&(this.styleMessageVisible=!1),this.tooltipMessage.mathjaxTexs.push("")},reduceMathjax(){let e=this.tooltipMessage.mathjaxTexs.length;e>1&&this.tooltipMessage.mathjaxTexs.splice(e-1,1)},clearMathjax(){this.tooltipMessage.mathjaxTexs[0]="";while(this.tooltipMessage.mathjaxTexs.length>1)this.tooltipMessage.mathjaxTexs.splice(length-1,1)},confirmMathjax(){let e=this.tooltipMessage.editor;if(this.tooltipMessage.mathjaxTexs.length>1){let t=[];this.tooltipMessage.mathjaxTexs.forEach((o=>{t.push(e.objToDom({type:"mathjax",data:o}))})),e.insertElement(t)}else{let t={type:"mathjax",data:this.tooltipMessage.mathjaxTexs[0]};this.styleMessageVisible&&(t.style={display:this.display,"margin-top":isNaN(parseInt(this.marginTop))?this.marginTop:this.marginTop+"px","margin-bottom":isNaN(parseInt(this.marginBottom))?this.marginBottom:this.marginBottom+"px","margin-left":isNaN(parseInt(this.marginLeft))?this.marginLeft:this.marginLeft+"px","margin-right":isNaN(parseInt(this.marginRight))?this.marginRight:this.marginRight+"px"}),console.log("obj:",t),e.insertElement(e.objToDom(t))}this.cancalMathjax()},cancalMathjax(){this.tooltipMessage.mathjaxOperationShow=!1}}},ut=ft,mt=(0,dt.Z)(ut,pt,ht,!1,null,null,null),Nt=mt.exports,Ct={components:{"v-imageOperation":gt,"v-mathjaxOperation":Nt},data(){return{headerParagraphType:null,rangeNotInEditor:!0,tooltipMessage:{editor:null,anotherEditor:null,imageOperationShow:!1,imageBase64:null,imageTitle:null,imageStyle:null,imgStyle:null,mathjaxOperationShow:!1,mathjaxTexs:[""],mathjaxStyle:null}}},props:{editor:{type:Object,default:null},anotherEditor:{type:Object,default:null},allEditors:{type:Array,default:null}},watch:{editor(e){this.tooltipMessage.editor=e},anotherEditor(e){this.tooltipMessage.anotherEditor=e},allEditors(e){e.forEach((e=>{e.editorDom.addEventListener("mousedown",this.mousedown)}))}},methods:{exportJson(){this.editor&&this.editor.exportObjJsonFormatting("json.json")},setHeaderParagraph:ot,listOperation:nt,addMathjax(){this.tooltipMessage.mathjaxOperationShow=!0},addImage(){this.tooltipMessage.imageOperationShow=!0},selectionchangeDebounce:(0,it.Z)((function(){if(!this.editor.editable)return;let{nodeApi:e,rangeApi:t}=this.editor,o=t.getRange();if(console.log("range:",o),o){let{startContainer:t,endContainer:n}=o;if(this.editor.editorDom.contains(t)&&this.editor.editorDom.contains(n)){this.rangeNotInEditor=!1,this.editor.recordRange(o);let i=e.getBlock(t),r=e.getBlock(n);if(i===r)if("paragraph"===i.className)this.headerParagraphType="正文";else if("header"===i.className)switch(i.nodeName){case"H1":this.headerParagraphType="标题1";break;case"H2":this.headerParagraphType="标题2";break;case"H3":this.headerParagraphType="标题3";break;case"H4":this.headerParagraphType="标题4";break;default:this.headerParagraphType=null;break}else this.headerParagraphType=null;return}this.rangeNotInEditor=!0}this.headerParagraphType=null}),100),mousedown(e){if(!this.editor||!this.editor.editable)return;let t=e.target,o=this.editor.editorDom;if(o!==t&&o.contains(t)){let e=this.editor.nodeApi.getBlock(t);if("mathjax"===t.className){console.log("复制 mathjax");let e,o=this.tooltipMessage.mathjaxTexs;while(o.length>0)o.splice(0,1);if(t.style.length>0)e=this.editor.domToObj(t),o.push(e.data),this.tooltipMessage.mathjaxStyle=e.style;else{while(t.previousSibling&&"mathjax"===t.previousSibling.className&&0===t.style.length)t=t.previousSibling;do{e=this.editor.domToObj(t),o.push(e.data),t=t.nextSibling}while(t&&"mathjax"===t.className&&0===t.style.length);this.tooltipMessage.mathjaxStyle=null}}else if("image"===e.className){console.log("复制 image");let t=this.editor.domToObj(e);this.tooltipMessage.imageBase64=t.src,this.tooltipMessage.imageTitle=t.title,this.tooltipMessage.imageStyle=t.imageStyle,this.tooltipMessage.imgStyle=t.imgStyle}}}},mounted(){document.addEventListener("selectionchange",this.selectionchangeDebounce)},destroyed(){document.removeEventListener("selectionchange",this.selectionchangeDebounce),this.allEditors.forEach((e=>{e.editorDom.removeEventListener("mousedown",this.mousedown)}))}},Et=Ct,yt=(0,dt.Z)(Et,et,tt,!1,null,null,null),vt=yt.exports,bt={components:{"v-tooltip":vt},data(){return{originalEditor:null,translationEditor:null,editing:null,anotherEditor:null,allEditors:null,cache:{}}},props:{paper:{type:String,default:""},layoutType:{type:Number,default:0},editable:{type:Boolean,default:!1}},watch:{paper(e,t){if(this.originalEditor.empty(),this.translationEditor.empty(),e){let t;t="/vue_project/dist/papers",this.originalEditor.loadJson(`${t}/${e}/english.json`,(e=>{})),this.translationEditor.loadJson(`${t}/${e}/chinese.json`,(e=>{}))}else this.originalEditor.empty(),this.translationEditor.empty()},layoutType(e){let t,o;switch(e){case 0:t="0%",o="0%";break;case 1:t="100%",o="0%";break;case 2:t="0%",o="100%";break;case 3:t="50%",o="50%";break;case 4:t="100%",o="0%";break;case 5:t="0%",o="100%";break;case 6:t="50%",o="50%";break}this.$refs.originalEditorContainer.style.width=t,this.$refs.translationEditorContainer.style.width=o},editable(e){this.originalEditor.setEditable(e),this.translationEditor.setEditable(e),this.editor||this.setEditing(this.translationEditor,this.originalEditor)}},methods:{setEditing(e,t){this.editing=e,this.anotherEditor=t}},mounted(){this.originalEditor=new Qe(this.$refs.originalEditor),this.translationEditor=new Qe(this.$refs.translationEditor),this.allEditors=[this.originalEditor,this.translationEditor]}},wt=bt,Tt=(0,dt.Z)(wt,d,c,!1,null,null,null),Ot=Tt.exports,xt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"paper_view-pdf"},[t("iframe",{ref:"iframe",staticClass:"iframe"})])},_t=[],St={props:{paper:{type:String,default:""}},watch:{paper(e,t){let o;o="/vue_project/dist/papers",e?this.$refs.iframe.contentWindow.location.replace(`${o}/${e}/${e}.pdf#view=FitH,top`):this.$refs.iframe.removeAttribute("src")}}},Rt=St,At=(0,dt.Z)(Rt,xt,_t,!1,null,null,null),kt=At.exports,Dt={components:{"v-viewEditor":Ot,"v-viewPdf":kt},data(){return{paperList:s,paperListVisible:!1,selectedPaperIndex:null,selectedPaper:null,layoutTypes:[{type:"P",title:"只展示pdf"},{type:"原",title:"只展示原始富文本"},{type:"译",title:"只展示翻译富文本"},{type:"富",title:"不展示pdf,只展示富文本"},{type:"F",title:"不展示翻译富文本,只展示pdf和原始富文本"},{type:"S",title:"不展示原始富文本,只展示pdf和翻译富文本"},{type:"全",title:"全部都展示"}],layoutType:null,editable:!1,needWatch:!0}},watch:{$route(){this.needWatch?this.watchRoute():this.needWatch=!0}},methods:{setPaperListVisible(e){"boolean"===typeof e?this.paperListVisible!==e&&(this.paperListVisible=e):this.paperListVisible=!this.paperListVisible},setPaper(e,t=!0){"number"===typeof e&&this.paperList[e]&&this.selectedPaperIndex!==e?(this.selectedPaperIndex=e,!s[e].allowChange&&this.editable&&(this.editable=!1),null===this.layoutType&&this.setLayoutType(5,!1),this.paperListVisible&&(this.paperListVisible=!1),setTimeout((()=>{this.selectedPaperIndex===e&&(this.selectedPaper=s[e].name)}),300)):(this.editable&&(this.editable=!1),this.selectedPaperIndex=this.selectedPaper=null),t&&this.setRoute()},setLayoutType(e,t=!0){if("number"===typeof e&&e!==this.layoutType){let o,n;switch(this.layoutType=e,e){case 0:o="100%",n="0";break;case 1:o="0",n="100%";break;case 2:o="0",n="100%";break;case 3:o="0",n="100%";break;case 4:o="50%",n="50%";break;case 5:o="50%",n="50%";break;case 6:o="34%",n="66%";break}this.$refs.pdf.style.width=o,this.$refs.editor.style.width=n,t&&this.setRoute()}},setEditable(e,t=!0){"boolean"===typeof e?e!==this.editable&&(this.editable=e):this.editable=!this.editable,t&&this.setRoute()},setRoute(){this.needWatch=!1;let e={};this.paperList[this.selectedPaperIndex]&&(e.paperId=this.selectedPaperIndex,e.layoutType=this.layoutType,this.editable&&(e.editable=!0)),this.$router.push({query:e})},watchRoute(){let{paperId:e,layoutType:t,editable:o}=this.$route.query;if(void 0!==e)if(e=parseInt(e),e>=0&&e<=s.length-1){let n,i=!1;t=parseInt(t),(t<0||t>6)&&(t=5,i=!0,this.needWatch=!1,n={paperId:e,layoutType:t}),"true"===o?s[e].allowChange?(o=!0,i&&(n.editable=o)):(o=!1,i?n.editable=o:(i=!0,this.needWatch=!1,n={paperId:e,layoutType:t})):o=!1,this.selectedPaperIndex!==e&&this.setPaper(e,!1),this.setLayoutType(t,!1),this.setEditable(o,!1),i&&this.$router.replace({query:n})}else this.setPaper(null,!1),this.$router.replace({query:{}})}},mounted(){this.watchRoute()}},Lt=Dt,It=(0,dt.Z)(Lt,l,a,!1,null,null,null),Mt=It.exports},6077:function(e,t,o){var n=o(614),i=String,r=TypeError;e.exports=function(e){if("object"==typeof e||n(e))return e;throw r("Can't set "+i(e)+" as a prototype")}},5787:function(e,t,o){var n=o(7976),i=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw i("Incorrect invocation")}},648:function(e,t,o){var n=o(1694),i=o(614),r=o(4326),l=o(5112),a=l("toStringTag"),s=Object,d="Arguments"==r(function(){return arguments}()),c=function(e,t){try{return e[t]}catch(o){}};e.exports=n?r:function(e){var t,o,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(o=c(t=s(e),a))?o:d?r(t):"Object"==(n=r(t))&&i(t.callee)?"Arguments":n}},3678:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},1060:function(e,t,o){var n=o(1702),i=Error,r=n("".replace),l=function(e){return String(i(e).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,s=a.test(l);e.exports=function(e,t){if(s&&"string"==typeof e&&!i.prepareStackTrace)while(t--)e=r(e,a,"");return e}},9587:function(e,t,o){var n=o(614),i=o(111),r=o(7674);e.exports=function(e,t,o){var l,a;return r&&n(l=t.constructor)&&l!==o&&i(a=l.prototype)&&a!==o.prototype&&r(e,a),e}},6277:function(e,t,o){var n=o(1340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},7674:function(e,t,o){var n=o(1702),i=o(9670),r=o(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,o={};try{e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),e(o,[]),t=o instanceof Array}catch(l){}return function(o,n){return i(o),r(n),t?e(o,n):o.__proto__=n,o}}():void 0)},1694:function(e,t,o){var n=o(5112),i=n("toStringTag"),r={};r[i]="z",e.exports="[object z]"===String(r)},1340:function(e,t,o){var n=o(648),i=String;e.exports=function(e){if("Symbol"===n(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},2801:function(e,t,o){"use strict";var n=o(2109),i=o(7854),r=o(5005),l=o(9114),a=o(3070).f,s=o(2597),d=o(5787),c=o(9587),g=o(6277),p=o(3678),h=o(1060),f=o(9781),u=o(1913),m="DOMException",N=r("Error"),C=r(m),E=function(){d(this,y);var e=arguments.length,t=g(e<1?void 0:arguments[0]),o=g(e<2?void 0:arguments[1],"Error"),n=new C(t,o),i=N(t);return i.name=m,a(n,"stack",l(1,h(i.stack,1))),c(n,this,E),n},y=E.prototype=C.prototype,v="stack"in N(m),b="stack"in new C(1,2),w=C&&f&&Object.getOwnPropertyDescriptor(i,m),T=!!w&&!(w.writable&&w.configurable),O=v&&!T&&!b;n({global:!0,constructor:!0,forced:u||O},{DOMException:O?E:C});var x=r(m),_=x.prototype;if(_.constructor!==x)for(var S in u||a(_,"constructor",l(1,x)),p)if(s(p,S)){var R=p[S],A=R.s;s(x,A)||a(x,A,l(6,R.c))}},711:function(e,t){"use strict";let o;o="undefined"===typeof self&&"undefined"!==typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!==typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},t["Z"]=o},8296:function(e,t,o){"use strict";o.d(t,{Z:function(){return i}});var n=o(711);function i(e,t,o=!1){let i,r,l,a,s;function d(){let c=(0,n.Z)()-a;c<t&&c>=0?i=setTimeout(d,t-c):(i=null,o||(s=e.apply(l,r),l=r=null))}function c(){l=this,r=arguments,a=(0,n.Z)();let c=o&&!i;return i||(i=setTimeout(d,t)),c&&(s=e.apply(l,r),l=r=null),s}return c}}}]);
//# sourceMappingURL=94.a7d9827f.js.map